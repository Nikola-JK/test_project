; generated by ARM C/C++ Compiler, 5.03 [Build 76]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o.\obj\os_task.o --asm_dir=.\List\ --list_dir=.\List\ --depend=.\obj\os_task.d --cpu=Cortex-M3 --apcs=interwork -O0 -I.\Source\APP -I.\Source\BSP -I.\Source\uCOS-II\Source -I.\Source\uCOS-II\uC-CPU -I.\Source\uCOS-II\uC-LIB -I.\Source\uCOS-II\Ports -I.\Source\uCGUI\Config -I.\Source\uCGUI\emWinDemo -I.\Source\uCGUI\inc -I.\Source\uCGUI\LCDDriver -I.\Source\uCGUI\uCGUIDemo -I.\Source\Libraries\STM32F10x_StdPeriph_Driver\inc -I.\Source\Libraries\CMSIS\Core\CM3 -I.\Source\APP\HMI -I"D:\Program Files (x86)\keil\ARM\RV31\INC" -I"D:\Program Files (x86)\keil\ARM\PACK\ARM\CMSIS\3.20.3\CMSIS\Include" -I"D:\Program Files (x86)\keil\ARM\PACK\Keil\STM32F1xx_DFP\1.0.2\Device\Include" -DSTM32F10X_HD --omf_browse=.\obj\os_task.crf Source\uCOS-II\Source\os_task.c]
                          THUMB

                          AREA ||i.OSTaskChangePrio||, CODE, READONLY, ALIGN=2

                  OSTaskChangePrio PROC
;;;50     #if OS_TASK_CHANGE_PRIO_EN > 0
;;;51     INT8U  OSTaskChangePrio (INT8U oldprio, INT8U newprio)
000000  e92d5ffc          PUSH     {r2-r12,lr}
;;;52     {
000004  4681              MOV      r9,r0
000006  460f              MOV      r7,r1
;;;53     #if OS_EVENT_EN
;;;54         OS_EVENT    *pevent;
;;;55     #endif
;;;56         OS_TCB      *ptcb;
;;;57         INT8U        x;
;;;58         INT8U        y;
;;;59     #if OS_LOWEST_PRIO <= 63
;;;60         INT8U        bitx;
;;;61         INT8U        bity;
;;;62     #else
;;;63         INT16U       bitx;
;;;64         INT16U       bity;
;;;65     #endif
;;;66         INT8U        y_old;
;;;67     #if OS_CRITICAL_METHOD == 3
;;;68         OS_CPU_SR    cpu_sr = 0;                                    /* Storage for CPU status register     */
000008  2000              MOVS     r0,#0
00000a  9000              STR      r0,[sp,#0]
;;;69     #endif
;;;70     
;;;71     
;;;72     
;;;73     #if OS_ARG_CHK_EN > 0
;;;74         if (oldprio >= OS_LOWEST_PRIO) {
00000c  f1b90f3f          CMP      r9,#0x3f
000010  db05              BLT      |L1.30|
;;;75             if (oldprio != OS_PRIO_SELF) {
000012  f1b90fff          CMP      r9,#0xff
000016  d002              BEQ      |L1.30|
;;;76                 return (OS_ERR_PRIO_INVALID);
000018  202a              MOVS     r0,#0x2a
                  |L1.26|
;;;77             }
;;;78         }
;;;79         if (newprio >= OS_LOWEST_PRIO) {
;;;80             return (OS_ERR_PRIO_INVALID);
;;;81         }
;;;82     #endif
;;;83         OS_ENTER_CRITICAL();
;;;84         if (OSTCBPrioTbl[newprio] != (OS_TCB *)0) {                 /* New priority must not already exist */
;;;85             OS_EXIT_CRITICAL();
;;;86             return (OS_ERR_PRIO_EXIST);
;;;87         }
;;;88         if (oldprio == OS_PRIO_SELF) {                              /* See if changing self                */
;;;89             oldprio = OSTCBCur->OSTCBPrio;                          /* Yes, get priority                   */
;;;90         }
;;;91         ptcb = OSTCBPrioTbl[oldprio];
;;;92         if (ptcb == (OS_TCB *)0) {                                  /* Does task to change exist?          */
;;;93             OS_EXIT_CRITICAL();                                     /* No, can't change its priority!      */
;;;94             return (OS_ERR_PRIO);
;;;95         }
;;;96         if (ptcb == OS_TCB_RESERVED) {                              /* Is task assigned to Mutex           */
;;;97             OS_EXIT_CRITICAL();                                     /* No, can't change its priority!      */
;;;98             return (OS_ERR_TASK_NOT_EXIST);
;;;99         }
;;;100    #if OS_LOWEST_PRIO <= 63
;;;101        y                     = (INT8U)(newprio >> 3);              /* Yes, compute new TCB fields         */
;;;102        x                     = (INT8U)(newprio & 0x07);
;;;103        bity                  = (INT8U)(1 << y);
;;;104        bitx                  = (INT8U)(1 << x);
;;;105    #else
;;;106        y                     = (INT8U)((newprio >> 4) & 0x0F);
;;;107        x                     = (INT8U)( newprio & 0x0F);
;;;108        bity                  = (INT16U)(1 << y);
;;;109        bitx                  = (INT16U)(1 << x);
;;;110    #endif
;;;111    
;;;112        OSTCBPrioTbl[oldprio] = (OS_TCB *)0;                        /* Remove TCB from old priority        */
;;;113        OSTCBPrioTbl[newprio] = ptcb;                               /* Place pointer to TCB @ new priority */
;;;114        y_old                 = ptcb->OSTCBY;
;;;115        if ((OSRdyTbl[y_old] & ptcb->OSTCBBitX) != 0) {             /* If task is ready make it not        */
;;;116            OSRdyTbl[y_old] &= ~ptcb->OSTCBBitX;
;;;117            if (OSRdyTbl[y_old] == 0) {
;;;118                OSRdyGrp &= ~ptcb->OSTCBBitY;
;;;119            }
;;;120            OSRdyGrp    |= bity;                                    /* Make new priority ready to run      */
;;;121            OSRdyTbl[y] |= bitx;
;;;122        }
;;;123    #if OS_EVENT_EN
;;;124        pevent = ptcb->OSTCBEventPtr;
;;;125        if (pevent != (OS_EVENT *)0) {                              /* ... remove from event wait list     */
;;;126            pevent->OSEventTbl[y_old] &= ~ptcb->OSTCBBitX;
;;;127            if (pevent->OSEventTbl[y_old] == 0) {
;;;128                pevent->OSEventGrp &= ~ptcb->OSTCBBitY;
;;;129            }
;;;130            pevent->OSEventGrp    |= bity;                          /* Add new priority to wait list       */
;;;131            pevent->OSEventTbl[y] |= bitx;
;;;132        }
;;;133    #endif
;;;134        ptcb->OSTCBPrio = newprio;                                  /* Set new task priority               */
;;;135        ptcb->OSTCBY    = y;
;;;136        ptcb->OSTCBX    = x;
;;;137        ptcb->OSTCBBitY = bity;
;;;138        ptcb->OSTCBBitX = bitx;
;;;139        OS_EXIT_CRITICAL();
;;;140        if (OSRunning == OS_TRUE) {
;;;141            OS_Sched();                                             /* Find new highest priority task      */
;;;142        }
;;;143        return (OS_ERR_NONE);
;;;144    }
00001a  e8bd9ffc          POP      {r2-r12,pc}
                  |L1.30|
00001e  2f3f              CMP      r7,#0x3f              ;79
000020  db01              BLT      |L1.38|
000022  202a              MOVS     r0,#0x2a              ;80
000024  e7f9              B        |L1.26|
                  |L1.38|
000026  f7fffffe          BL       OS_CPU_SR_Save
00002a  9000              STR      r0,[sp,#0]            ;83
00002c  4849              LDR      r0,|L1.340|
00002e  f8500027          LDR      r0,[r0,r7,LSL #2]     ;84
000032  b120              CBZ      r0,|L1.62|
000034  9800              LDR      r0,[sp,#0]            ;85
000036  f7fffffe          BL       OS_CPU_SR_Restore
00003a  2028              MOVS     r0,#0x28              ;86
00003c  e7ed              B        |L1.26|
                  |L1.62|
00003e  f1b90fff          CMP      r9,#0xff              ;88
000042  d103              BNE      |L1.76|
000044  4844              LDR      r0,|L1.344|
000046  6800              LDR      r0,[r0,#0]            ;89  ; OSTCBCur
000048  f890902e          LDRB     r9,[r0,#0x2e]         ;89
                  |L1.76|
00004c  4841              LDR      r0,|L1.340|
00004e  f8504029          LDR      r4,[r0,r9,LSL #2]     ;91
000052  b924              CBNZ     r4,|L1.94|
000054  9800              LDR      r0,[sp,#0]            ;93
000056  f7fffffe          BL       OS_CPU_SR_Restore
00005a  2029              MOVS     r0,#0x29              ;94
00005c  e7dd              B        |L1.26|
                  |L1.94|
00005e  2c01              CMP      r4,#1                 ;96
000060  d104              BNE      |L1.108|
000062  9800              LDR      r0,[sp,#0]            ;97
000064  f7fffffe          BL       OS_CPU_SR_Restore
000068  2043              MOVS     r0,#0x43              ;98
00006a  e7d6              B        |L1.26|
                  |L1.108|
00006c  ea4f08e7          ASR      r8,r7,#3              ;101
000070  f0070007          AND      r0,r7,#7              ;102
000074  9001              STR      r0,[sp,#4]            ;102
000076  2001              MOVS     r0,#1                 ;103
000078  fa00f008          LSL      r0,r0,r8              ;103
00007c  f0000bff          AND      r11,r0,#0xff          ;103
000080  2101              MOVS     r1,#1                 ;104
000082  9801              LDR      r0,[sp,#4]            ;104
000084  4081              LSLS     r1,r1,r0              ;104
000086  f0010aff          AND      r10,r1,#0xff          ;104
00008a  2000              MOVS     r0,#0                 ;112
00008c  4931              LDR      r1,|L1.340|
00008e  f8410029          STR      r0,[r1,r9,LSL #2]     ;112
000092  4608              MOV      r0,r1                 ;113
000094  f8404027          STR      r4,[r0,r7,LSL #2]     ;113
000098  f8946030          LDRB     r6,[r4,#0x30]         ;114
00009c  482f              LDR      r0,|L1.348|
00009e  5d80              LDRB     r0,[r0,r6]            ;115
0000a0  f8941031          LDRB     r1,[r4,#0x31]         ;115
0000a4  4208              TST      r0,r1                 ;115
0000a6  d01e              BEQ      |L1.230|
0000a8  482c              LDR      r0,|L1.348|
0000aa  5d80              LDRB     r0,[r0,r6]            ;116
0000ac  f8941031          LDRB     r1,[r4,#0x31]         ;116
0000b0  4388              BICS     r0,r0,r1              ;116
0000b2  492a              LDR      r1,|L1.348|
0000b4  5588              STRB     r0,[r1,r6]            ;116
0000b6  4608              MOV      r0,r1                 ;117
0000b8  5d80              LDRB     r0,[r0,r6]            ;117
0000ba  b930              CBNZ     r0,|L1.202|
0000bc  f8941032          LDRB     r1,[r4,#0x32]         ;118
0000c0  4827              LDR      r0,|L1.352|
0000c2  7800              LDRB     r0,[r0,#0]            ;118  ; OSRdyGrp
0000c4  4388              BICS     r0,r0,r1              ;118
0000c6  4926              LDR      r1,|L1.352|
0000c8  7008              STRB     r0,[r1,#0]            ;118
                  |L1.202|
0000ca  4825              LDR      r0,|L1.352|
0000cc  7800              LDRB     r0,[r0,#0]            ;120  ; OSRdyGrp
0000ce  ea40000b          ORR      r0,r0,r11             ;120
0000d2  4923              LDR      r1,|L1.352|
0000d4  7008              STRB     r0,[r1,#0]            ;120
0000d6  4821              LDR      r0,|L1.348|
0000d8  f8100008          LDRB     r0,[r0,r8]            ;121
0000dc  ea40000a          ORR      r0,r0,r10             ;121
0000e0  491e              LDR      r1,|L1.348|
0000e2  f8010008          STRB     r0,[r1,r8]            ;121
                  |L1.230|
0000e6  69e5              LDR      r5,[r4,#0x1c]         ;124
0000e8  b1f5              CBZ      r5,|L1.296|
0000ea  f105000b          ADD      r0,r5,#0xb            ;126
0000ee  5d80              LDRB     r0,[r0,r6]            ;126
0000f0  f8941031          LDRB     r1,[r4,#0x31]         ;126
0000f4  4388              BICS     r0,r0,r1              ;126
0000f6  f105010b          ADD      r1,r5,#0xb            ;126
0000fa  5588              STRB     r0,[r1,r6]            ;126
0000fc  4608              MOV      r0,r1                 ;127
0000fe  5d80              LDRB     r0,[r0,r6]            ;127
000100  b920              CBNZ     r0,|L1.268|
000102  7aa8              LDRB     r0,[r5,#0xa]          ;128
000104  f8941032          LDRB     r1,[r4,#0x32]         ;128
000108  4388              BICS     r0,r0,r1              ;128
00010a  72a8              STRB     r0,[r5,#0xa]          ;128
                  |L1.268|
00010c  7aa8              LDRB     r0,[r5,#0xa]          ;130
00010e  ea40000b          ORR      r0,r0,r11             ;130
000112  72a8              STRB     r0,[r5,#0xa]          ;130
000114  f105000b          ADD      r0,r5,#0xb            ;131
000118  f8100008          LDRB     r0,[r0,r8]            ;131
00011c  ea40000a          ORR      r0,r0,r10             ;131
000120  f105010b          ADD      r1,r5,#0xb            ;131
000124  f8010008          STRB     r0,[r1,r8]            ;131
                  |L1.296|
000128  f884702e          STRB     r7,[r4,#0x2e]         ;134
00012c  f8848030          STRB     r8,[r4,#0x30]         ;135
000130  9801              LDR      r0,[sp,#4]            ;136
000132  f884002f          STRB     r0,[r4,#0x2f]         ;136
000136  f884b032          STRB     r11,[r4,#0x32]        ;137
00013a  f884a031          STRB     r10,[r4,#0x31]        ;138
00013e  9800              LDR      r0,[sp,#0]            ;139
000140  f7fffffe          BL       OS_CPU_SR_Restore
000144  4807              LDR      r0,|L1.356|
000146  7800              LDRB     r0,[r0,#0]            ;140  ; OSRunning
000148  2801              CMP      r0,#1                 ;140
00014a  d101              BNE      |L1.336|
00014c  f7fffffe          BL       OS_Sched
                  |L1.336|
000150  2000              MOVS     r0,#0                 ;143
000152  e762              B        |L1.26|
;;;145    #endif
                          ENDP

                  |L1.340|
                          DCD      OSTCBPrioTbl
                  |L1.344|
                          DCD      OSTCBCur
                  |L1.348|
                          DCD      OSRdyTbl
                  |L1.352|
                          DCD      OSRdyGrp
                  |L1.356|
                          DCD      OSRunning

                          AREA ||i.OSTaskCreate||, CODE, READONLY, ALIGN=2

                  OSTaskCreate PROC
;;;187    #if OS_TASK_CREATE_EN > 0
;;;188    INT8U  OSTaskCreate(void (*task)(void *p_arg),void *p_arg,OS_STK *ptos,INT8U prio)
000000  e92d4ffe          PUSH     {r1-r11,lr}
;;;189    {
000004  4606              MOV      r6,r0
000006  460f              MOV      r7,r1
000008  4690              MOV      r8,r2
00000a  461c              MOV      r4,r3
;;;190        OS_STK    *psp;
;;;191        INT8U      err;
;;;192    #if OS_CRITICAL_METHOD == 3                  /* Allocate storage for CPU status register               */
;;;193        OS_CPU_SR  cpu_sr = 0;
00000c  f04f0900          MOV      r9,#0
;;;194    #endif
;;;195    
;;;196    
;;;197    
;;;198    #if OS_ARG_CHK_EN > 0
;;;199        if(prio > OS_LOWEST_PRIO) { /* Make sure priority is within allowable range           */
000010  2c3f              CMP      r4,#0x3f
000012  dd02              BLE      |L2.26|
;;;200            return (OS_ERR_PRIO_INVALID);
000014  202a              MOVS     r0,#0x2a
                  |L2.22|
;;;201        }
;;;202    #endif
;;;203    
;;;204        OS_ENTER_CRITICAL();    //保存全局中断标志,关中断
;;;205    
;;;206        if(OSIntNesting>0) {    /* Make sure we don't create the task from within an ISR  */
;;;207            OS_EXIT_CRITICAL();	//恢复全局中断标志
;;;208            return (OS_ERR_TASK_CREATE_ISR);
;;;209        }
;;;210    
;;;211        if(OSTCBPrioTbl[prio]==(OS_TCB *)0) { /* Make sure task doesn't already exist at this priority  */
;;;212            OSTCBPrioTbl[prio]=OS_TCB_RESERVED;/* Reserve the priority to prevent others from doing ...  */
;;;213            /* ... the same thing until task is created.              */
;;;214            OS_EXIT_CRITICAL();	//恢复全局中断标志
;;;215            psp = OSTaskStkInit(task,p_arg,ptos,0);              /* Initialize the task's stack         */
;;;216            err = OS_TCBInit(prio,psp,(OS_STK *)0,0,0,(void *)0,0);
;;;217            if(err == OS_ERR_NONE) {
;;;218                if(OSRunning==OS_TRUE) {
;;;219                    /* Find highest priority task if multitasking has started */
;;;220                    OS_Sched();
;;;221                }
;;;222            } else {
;;;223                OS_ENTER_CRITICAL();  //保存全局中断标志,关中断
;;;224                OSTCBPrioTbl[prio] = (OS_TCB *)0;/* Make this priority available to others                 */
;;;225                OS_EXIT_CRITICAL();	  //恢复全局中断标志
;;;226            }
;;;227            return (err);
;;;228        }
;;;229    
;;;230        OS_EXIT_CRITICAL();	  //恢复全局中断标志
;;;231        return (OS_ERR_PRIO_EXIST);
;;;232    }
000016  e8bd8ffe          POP      {r1-r11,pc}
                  |L2.26|
00001a  f7fffffe          BL       OS_CPU_SR_Save
00001e  4681              MOV      r9,r0                 ;204
000020  481f              LDR      r0,|L2.160|
000022  7800              LDRB     r0,[r0,#0]            ;206  ; OSIntNesting
000024  2800              CMP      r0,#0                 ;206
000026  dd04              BLE      |L2.50|
000028  4648              MOV      r0,r9                 ;207
00002a  f7fffffe          BL       OS_CPU_SR_Restore
00002e  203c              MOVS     r0,#0x3c              ;208
000030  e7f1              B        |L2.22|
                  |L2.50|
000032  481c              LDR      r0,|L2.164|
000034  f8500024          LDR      r0,[r0,r4,LSL #2]     ;211
000038  bb60              CBNZ     r0,|L2.148|
00003a  2001              MOVS     r0,#1                 ;212
00003c  4919              LDR      r1,|L2.164|
00003e  f8410024          STR      r0,[r1,r4,LSL #2]     ;212
000042  4648              MOV      r0,r9                 ;214
000044  f7fffffe          BL       OS_CPU_SR_Restore
000048  2300              MOVS     r3,#0                 ;215
00004a  4642              MOV      r2,r8                 ;215
00004c  4639              MOV      r1,r7                 ;215
00004e  4630              MOV      r0,r6                 ;215
000050  f7fffffe          BL       OSTaskStkInit
000054  4682              MOV      r10,r0                ;215
000056  2000              MOVS     r0,#0                 ;216
000058  9000              STR      r0,[sp,#0]            ;216
00005a  9001              STR      r0,[sp,#4]            ;216
00005c  4603              MOV      r3,r0                 ;216
00005e  4602              MOV      r2,r0                 ;216
000060  4651              MOV      r1,r10                ;216
000062  9002              STR      r0,[sp,#8]            ;216
000064  4620              MOV      r0,r4                 ;216
000066  f7fffffe          BL       OS_TCBInit
00006a  4605              MOV      r5,r0                 ;216
00006c  b935              CBNZ     r5,|L2.124|
00006e  480e              LDR      r0,|L2.168|
000070  7800              LDRB     r0,[r0,#0]            ;218  ; OSRunning
000072  2801              CMP      r0,#1                 ;218
000074  d10c              BNE      |L2.144|
000076  f7fffffe          BL       OS_Sched
00007a  e009              B        |L2.144|
                  |L2.124|
00007c  f7fffffe          BL       OS_CPU_SR_Save
000080  4681              MOV      r9,r0                 ;223
000082  2000              MOVS     r0,#0                 ;224
000084  4907              LDR      r1,|L2.164|
000086  f8410024          STR      r0,[r1,r4,LSL #2]     ;224
00008a  4648              MOV      r0,r9                 ;225
00008c  f7fffffe          BL       OS_CPU_SR_Restore
                  |L2.144|
000090  4628              MOV      r0,r5                 ;227
000092  e7c0              B        |L2.22|
                  |L2.148|
000094  4648              MOV      r0,r9                 ;230
000096  f7fffffe          BL       OS_CPU_SR_Restore
00009a  2028              MOVS     r0,#0x28              ;231
00009c  e7bb              B        |L2.22|
;;;233    #endif
                          ENDP

00009e  0000              DCW      0x0000
                  |L2.160|
                          DCD      OSIntNesting
                  |L2.164|
                          DCD      OSTCBPrioTbl
                  |L2.168|
                          DCD      OSRunning

                          AREA ||i.OSTaskCreateExt||, CODE, READONLY, ALIGN=2

                  OSTaskCreateExt PROC
;;;305    #if OS_TASK_CREATE_EXT_EN > 0
;;;306    INT8U  OSTaskCreateExt (void   (*task)(void *p_arg),
000000  e92d4ff0          PUSH     {r4-r11,lr}
;;;307                            void    *p_arg,
;;;308                            OS_STK  *ptos,
;;;309                            INT8U    prio,
;;;310                            INT16U   id,
;;;311                            OS_STK  *pbos,
;;;312                            INT32U   stk_size,
;;;313                            void    *pext,
;;;314                            INT16U   opt)
;;;315    {
000004  b085              SUB      sp,sp,#0x14
000006  4681              MOV      r9,r0
000008  468a              MOV      r10,r1
00000a  4693              MOV      r11,r2
00000c  461c              MOV      r4,r3
00000e  e9dd780f          LDRD     r7,r8,[sp,#0x3c]
000012  9d12              LDR      r5,[sp,#0x48]
;;;316        OS_STK    *psp;
;;;317        INT8U      err;
;;;318    #if OS_CRITICAL_METHOD == 3                  /* Allocate storage for CPU status register               */
;;;319        OS_CPU_SR  cpu_sr = 0;
000014  2000              MOVS     r0,#0
000016  9003              STR      r0,[sp,#0xc]
;;;320    #endif
;;;321    
;;;322    
;;;323    
;;;324    #if OS_ARG_CHK_EN > 0
;;;325        if (prio > OS_LOWEST_PRIO) {             /* Make sure priority is within allowable range           */
000018  2c3f              CMP      r4,#0x3f
00001a  dd03              BLE      |L3.36|
;;;326            return (OS_ERR_PRIO_INVALID);
00001c  202a              MOVS     r0,#0x2a
                  |L3.30|
;;;327        }
;;;328    #endif
;;;329        OS_ENTER_CRITICAL();
;;;330        if (OSIntNesting > 0) {                  /* Make sure we don't create the task from within an ISR  */
;;;331            OS_EXIT_CRITICAL();
;;;332            return (OS_ERR_TASK_CREATE_ISR);
;;;333        }
;;;334        if (OSTCBPrioTbl[prio] == (OS_TCB *)0) { /* Make sure task doesn't already exist at this priority  */
;;;335            OSTCBPrioTbl[prio] = OS_TCB_RESERVED;/* Reserve the priority to prevent others from doing ...  */
;;;336            /* ... the same thing until task is created.              */
;;;337            OS_EXIT_CRITICAL();
;;;338    
;;;339    #if OS_TASK_STAT_STK_CHK_EN > 0
;;;340            OS_TaskStkClr(pbos, stk_size, opt);                    /* Clear the task stack (if needed)     */
;;;341    #endif
;;;342    
;;;343            psp = OSTaskStkInit(task, p_arg, ptos, opt);           /* Initialize the task's stack          */
;;;344            err = OS_TCBInit(prio, psp, pbos, id, stk_size, pext, opt);
;;;345            if (err == OS_ERR_NONE) {
;;;346                if (OSRunning == OS_TRUE) {                        /* Find HPT if multitasking has started */
;;;347                    OS_Sched();
;;;348                }
;;;349            } else {
;;;350                OS_ENTER_CRITICAL();
;;;351                OSTCBPrioTbl[prio] = (OS_TCB *)0;                  /* Make this priority avail. to others  */
;;;352                OS_EXIT_CRITICAL();
;;;353            }
;;;354            return (err);
;;;355        }
;;;356        OS_EXIT_CRITICAL();
;;;357        return (OS_ERR_PRIO_EXIST);
;;;358    }
00001e  b005              ADD      sp,sp,#0x14
000020  e8bd8ff0          POP      {r4-r11,pc}
                  |L3.36|
000024  f7fffffe          BL       OS_CPU_SR_Save
000028  9003              STR      r0,[sp,#0xc]          ;329
00002a  4822              LDR      r0,|L3.180|
00002c  7800              LDRB     r0,[r0,#0]            ;330  ; OSIntNesting
00002e  2800              CMP      r0,#0                 ;330
000030  dd04              BLE      |L3.60|
000032  9803              LDR      r0,[sp,#0xc]          ;331
000034  f7fffffe          BL       OS_CPU_SR_Restore
000038  203c              MOVS     r0,#0x3c              ;332
00003a  e7f0              B        |L3.30|
                  |L3.60|
00003c  481e              LDR      r0,|L3.184|
00003e  f8500024          LDR      r0,[r0,r4,LSL #2]     ;334
000042  bb88              CBNZ     r0,|L3.168|
000044  2001              MOVS     r0,#1                 ;335
000046  491c              LDR      r1,|L3.184|
000048  f8410024          STR      r0,[r1,r4,LSL #2]     ;335
00004c  9803              LDR      r0,[sp,#0xc]          ;337
00004e  f7fffffe          BL       OS_CPU_SR_Restore
000052  462a              MOV      r2,r5                 ;340
000054  4641              MOV      r1,r8                 ;340
000056  4638              MOV      r0,r7                 ;340
000058  f7fffffe          BL       OS_TaskStkClr
00005c  462b              MOV      r3,r5                 ;343
00005e  465a              MOV      r2,r11                ;343
000060  4651              MOV      r1,r10                ;343
000062  4648              MOV      r0,r9                 ;343
000064  f7fffffe          BL       OSTaskStkInit
000068  9004              STR      r0,[sp,#0x10]         ;343
00006a  9811              LDR      r0,[sp,#0x44]         ;344
00006c  e9cd8000          STRD     r8,r0,[sp,#0]         ;344
000070  9502              STR      r5,[sp,#8]            ;344
000072  463a              MOV      r2,r7                 ;344
000074  4620              MOV      r0,r4                 ;344
000076  9b0e              LDR      r3,[sp,#0x38]         ;344
000078  9904              LDR      r1,[sp,#0x10]         ;344
00007a  f7fffffe          BL       OS_TCBInit
00007e  4606              MOV      r6,r0                 ;344
000080  b936              CBNZ     r6,|L3.144|
000082  480e              LDR      r0,|L3.188|
000084  7800              LDRB     r0,[r0,#0]            ;346  ; OSRunning
000086  2801              CMP      r0,#1                 ;346
000088  d10c              BNE      |L3.164|
00008a  f7fffffe          BL       OS_Sched
00008e  e009              B        |L3.164|
                  |L3.144|
000090  f7fffffe          BL       OS_CPU_SR_Save
000094  9003              STR      r0,[sp,#0xc]          ;350
000096  2000              MOVS     r0,#0                 ;351
000098  4907              LDR      r1,|L3.184|
00009a  f8410024          STR      r0,[r1,r4,LSL #2]     ;351
00009e  9803              LDR      r0,[sp,#0xc]          ;352
0000a0  f7fffffe          BL       OS_CPU_SR_Restore
                  |L3.164|
0000a4  4630              MOV      r0,r6                 ;354
0000a6  e7ba              B        |L3.30|
                  |L3.168|
0000a8  e7ff              B        |L3.170|
                  |L3.170|
0000aa  9803              LDR      r0,[sp,#0xc]          ;356
0000ac  f7fffffe          BL       OS_CPU_SR_Restore
0000b0  2028              MOVS     r0,#0x28              ;357
0000b2  e7b4              B        |L3.30|
;;;359    #endif
                          ENDP

                  |L3.180|
                          DCD      OSIntNesting
                  |L3.184|
                          DCD      OSTCBPrioTbl
                  |L3.188|
                          DCD      OSRunning

                          AREA ||i.OSTaskDel||, CODE, READONLY, ALIGN=2

                  OSTaskDel PROC
;;;397    #if OS_TASK_DEL_EN > 0
;;;398    INT8U  OSTaskDel (INT8U prio)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;399    {
000004  4605              MOV      r5,r0
;;;400    #if OS_EVENT_EN
;;;401        OS_EVENT     *pevent;
;;;402    #endif
;;;403    #if (OS_FLAG_EN > 0) && (OS_MAX_FLAGS > 0)
;;;404        OS_FLAG_NODE *pnode;
;;;405    #endif
;;;406        OS_TCB       *ptcb;
;;;407        INT8U         y;
;;;408    #if OS_CRITICAL_METHOD == 3                      /* Allocate storage for CPU status register           */
;;;409        OS_CPU_SR     cpu_sr = 0;
000006  f04f0900          MOV      r9,#0
;;;410    #endif
;;;411    
;;;412    
;;;413    
;;;414        if (OSIntNesting > 0) {                                     /* See if trying to delete from ISR    */
00000a  4854              LDR      r0,|L4.348|
00000c  7800              LDRB     r0,[r0,#0]  ; OSIntNesting
00000e  2800              CMP      r0,#0
000010  dd02              BLE      |L4.24|
;;;415            return (OS_ERR_TASK_DEL_ISR);
000012  2040              MOVS     r0,#0x40
                  |L4.20|
;;;416        }
;;;417        if (prio == OS_TASK_IDLE_PRIO) {                            /* Not allowed to delete idle task     */
;;;418            return (OS_ERR_TASK_DEL_IDLE);
;;;419        }
;;;420    #if OS_ARG_CHK_EN > 0
;;;421        if (prio >= OS_LOWEST_PRIO) {                               /* Task priority valid ?               */
;;;422            if (prio != OS_PRIO_SELF) {
;;;423                return (OS_ERR_PRIO_INVALID);
;;;424            }
;;;425        }
;;;426    #endif
;;;427    
;;;428        OS_ENTER_CRITICAL();
;;;429        if (prio == OS_PRIO_SELF) {                                 /* See if requesting to delete self    */
;;;430            prio = OSTCBCur->OSTCBPrio;                             /* Set priority to delete to current   */
;;;431        }
;;;432        ptcb = OSTCBPrioTbl[prio];
;;;433        if (ptcb == (OS_TCB *)0) {                                  /* Task to delete must exist           */
;;;434            OS_EXIT_CRITICAL();
;;;435            return (OS_ERR_TASK_NOT_EXIST);
;;;436        }
;;;437        if (ptcb == OS_TCB_RESERVED) {                              /* Must not be assigned to Mutex       */
;;;438            OS_EXIT_CRITICAL();
;;;439            return (OS_ERR_TASK_DEL);
;;;440        }
;;;441        y            =  ptcb->OSTCBY;
;;;442        OSRdyTbl[y] &= ~ptcb->OSTCBBitX;
;;;443        if (OSRdyTbl[y] == 0) {                                     /* Make task not ready                 */
;;;444            OSRdyGrp &= ~ptcb->OSTCBBitY;
;;;445        }
;;;446    
;;;447    #if OS_EVENT_EN
;;;448        pevent = ptcb->OSTCBEventPtr;
;;;449        if (pevent != (OS_EVENT *)0) {                              /* If task is waiting on event         */
;;;450            pevent->OSEventTbl[y] &= ~ptcb->OSTCBBitX;
;;;451            if (pevent->OSEventTbl[y] == 0) {                       /* ... remove task from ...            */
;;;452                pevent->OSEventGrp &= ~ptcb->OSTCBBitY;             /* ... event ctrl block                */
;;;453            }
;;;454        }
;;;455    #endif
;;;456    
;;;457    #if (OS_FLAG_EN > 0) && (OS_MAX_FLAGS > 0)
;;;458        pnode = ptcb->OSTCBFlagNode;
;;;459        if (pnode != (OS_FLAG_NODE *)0) {                           /* If task is waiting on event flag    */
;;;460            OS_FlagUnlink(pnode);                                   /* Remove from wait list               */
;;;461        }
;;;462    #endif
;;;463    
;;;464        ptcb->OSTCBDly      = 0;                                    /* Prevent OSTimeTick() from updating  */
;;;465        ptcb->OSTCBStat     = OS_STAT_RDY;                          /* Prevent task from being resumed     */
;;;466        ptcb->OSTCBStatPend = OS_STAT_PEND_OK;
;;;467        if (OSLockNesting < 255u) {                                 /* Make sure we don't context switch   */
;;;468            OSLockNesting++;
;;;469        }
;;;470        OS_EXIT_CRITICAL();                                         /* Enabling INT. ignores next instruc. */
;;;471        OS_Dummy();                                                 /* ... Dummy ensures that INTs will be */
;;;472        OS_ENTER_CRITICAL();                                        /* ... disabled HERE!                  */
;;;473        if (OSLockNesting > 0) {                                    /* Remove context switch lock          */
;;;474            OSLockNesting--;
;;;475        }
;;;476        OSTaskDelHook(ptcb);                                        /* Call user defined hook              */
;;;477        OSTaskCtr--;                                                /* One less task being managed         */
;;;478        OSTCBPrioTbl[prio] = (OS_TCB *)0;                           /* Clear old priority entry            */
;;;479        if (ptcb->OSTCBPrev == (OS_TCB *)0) {                       /* Remove from TCB chain               */
;;;480            ptcb->OSTCBNext->OSTCBPrev = (OS_TCB *)0;
;;;481            OSTCBList                  = ptcb->OSTCBNext;
;;;482        } else {
;;;483            ptcb->OSTCBPrev->OSTCBNext = ptcb->OSTCBNext;
;;;484            ptcb->OSTCBNext->OSTCBPrev = ptcb->OSTCBPrev;
;;;485        }
;;;486        ptcb->OSTCBNext   = OSTCBFreeList;                          /* Return TCB to free TCB list         */
;;;487        OSTCBFreeList     = ptcb;
;;;488    #if OS_TASK_NAME_SIZE > 1
;;;489        ptcb->OSTCBTaskName[0] = '?';                               /* Unknown name                        */
;;;490        ptcb->OSTCBTaskName[1] = OS_ASCII_NUL;
;;;491    #endif
;;;492        OS_EXIT_CRITICAL();
;;;493        if (OSRunning == OS_TRUE) {
;;;494            OS_Sched();                                             /* Find new highest priority task      */
;;;495        }
;;;496        return (OS_ERR_NONE);
;;;497    }
000014  e8bd87f0          POP      {r4-r10,pc}
                  |L4.24|
000018  2d3f              CMP      r5,#0x3f              ;417
00001a  d101              BNE      |L4.32|
00001c  203e              MOVS     r0,#0x3e              ;418
00001e  e7f9              B        |L4.20|
                  |L4.32|
000020  2d3f              CMP      r5,#0x3f              ;421
000022  db03              BLT      |L4.44|
000024  2dff              CMP      r5,#0xff              ;422
000026  d001              BEQ      |L4.44|
000028  202a              MOVS     r0,#0x2a              ;423
00002a  e7f3              B        |L4.20|
                  |L4.44|
00002c  f7fffffe          BL       OS_CPU_SR_Save
000030  4681              MOV      r9,r0                 ;428
000032  2dff              CMP      r5,#0xff              ;429
000034  d103              BNE      |L4.62|
000036  484a              LDR      r0,|L4.352|
000038  6800              LDR      r0,[r0,#0]            ;430  ; OSTCBCur
00003a  f890502e          LDRB     r5,[r0,#0x2e]         ;430
                  |L4.62|
00003e  4849              LDR      r0,|L4.356|
000040  f8504025          LDR      r4,[r0,r5,LSL #2]     ;432
000044  b924              CBNZ     r4,|L4.80|
000046  4648              MOV      r0,r9                 ;434
000048  f7fffffe          BL       OS_CPU_SR_Restore
00004c  2043              MOVS     r0,#0x43              ;435
00004e  e7e1              B        |L4.20|
                  |L4.80|
000050  2c01              CMP      r4,#1                 ;437
000052  d104              BNE      |L4.94|
000054  4648              MOV      r0,r9                 ;438
000056  f7fffffe          BL       OS_CPU_SR_Restore
00005a  203d              MOVS     r0,#0x3d              ;439
00005c  e7da              B        |L4.20|
                  |L4.94|
00005e  f8947030          LDRB     r7,[r4,#0x30]         ;441
000062  4841              LDR      r0,|L4.360|
000064  5dc0              LDRB     r0,[r0,r7]            ;442
000066  f8941031          LDRB     r1,[r4,#0x31]         ;442
00006a  4388              BICS     r0,r0,r1              ;442
00006c  493e              LDR      r1,|L4.360|
00006e  55c8              STRB     r0,[r1,r7]            ;442
000070  4608              MOV      r0,r1                 ;443
000072  5dc0              LDRB     r0,[r0,r7]            ;443
000074  b930              CBNZ     r0,|L4.132|
000076  f8941032          LDRB     r1,[r4,#0x32]         ;444
00007a  483c              LDR      r0,|L4.364|
00007c  7800              LDRB     r0,[r0,#0]            ;444  ; OSRdyGrp
00007e  4388              BICS     r0,r0,r1              ;444
000080  493a              LDR      r1,|L4.364|
000082  7008              STRB     r0,[r1,#0]            ;444
                  |L4.132|
000084  69e6              LDR      r6,[r4,#0x1c]         ;448
000086  b186              CBZ      r6,|L4.170|
000088  f106000b          ADD      r0,r6,#0xb            ;450
00008c  5dc0              LDRB     r0,[r0,r7]            ;450
00008e  f8941031          LDRB     r1,[r4,#0x31]         ;450
000092  4388              BICS     r0,r0,r1              ;450
000094  f106010b          ADD      r1,r6,#0xb            ;450
000098  55c8              STRB     r0,[r1,r7]            ;450
00009a  4608              MOV      r0,r1                 ;451
00009c  5dc0              LDRB     r0,[r0,r7]            ;451
00009e  b920              CBNZ     r0,|L4.170|
0000a0  7ab0              LDRB     r0,[r6,#0xa]          ;452
0000a2  f8941032          LDRB     r1,[r4,#0x32]         ;452
0000a6  4388              BICS     r0,r0,r1              ;452
0000a8  72b0              STRB     r0,[r6,#0xa]          ;452
                  |L4.170|
0000aa  f8d48024          LDR      r8,[r4,#0x24]         ;458
0000ae  f1b80f00          CMP      r8,#0                 ;459
0000b2  d002              BEQ      |L4.186|
0000b4  4640              MOV      r0,r8                 ;460
0000b6  f7fffffe          BL       OS_FlagUnlink
                  |L4.186|
0000ba  2000              MOVS     r0,#0                 ;464
0000bc  8560              STRH     r0,[r4,#0x2a]         ;464
0000be  f884002c          STRB     r0,[r4,#0x2c]         ;465
0000c2  f884002d          STRB     r0,[r4,#0x2d]         ;466
0000c6  482a              LDR      r0,|L4.368|
0000c8  7800              LDRB     r0,[r0,#0]            ;467  ; OSLockNesting
0000ca  28ff              CMP      r0,#0xff              ;467
0000cc  d204              BCS      |L4.216|
0000ce  4828              LDR      r0,|L4.368|
0000d0  7800              LDRB     r0,[r0,#0]            ;468  ; OSLockNesting
0000d2  1c40              ADDS     r0,r0,#1              ;468
0000d4  4926              LDR      r1,|L4.368|
0000d6  7008              STRB     r0,[r1,#0]            ;468
                  |L4.216|
0000d8  4648              MOV      r0,r9                 ;470
0000da  f7fffffe          BL       OS_CPU_SR_Restore
0000de  f7fffffe          BL       OS_Dummy
0000e2  f7fffffe          BL       OS_CPU_SR_Save
0000e6  4681              MOV      r9,r0                 ;472
0000e8  4821              LDR      r0,|L4.368|
0000ea  7800              LDRB     r0,[r0,#0]            ;473  ; OSLockNesting
0000ec  2800              CMP      r0,#0                 ;473
0000ee  dd04              BLE      |L4.250|
0000f0  481f              LDR      r0,|L4.368|
0000f2  7800              LDRB     r0,[r0,#0]            ;474  ; OSLockNesting
0000f4  1e40              SUBS     r0,r0,#1              ;474
0000f6  491e              LDR      r1,|L4.368|
0000f8  7008              STRB     r0,[r1,#0]            ;474
                  |L4.250|
0000fa  4620              MOV      r0,r4                 ;476
0000fc  f7fffffe          BL       OSTaskDelHook
000100  481c              LDR      r0,|L4.372|
000102  7800              LDRB     r0,[r0,#0]            ;477  ; OSTaskCtr
000104  1e40              SUBS     r0,r0,#1              ;477
000106  491b              LDR      r1,|L4.372|
000108  7008              STRB     r0,[r1,#0]            ;477
00010a  2000              MOVS     r0,#0                 ;478
00010c  4915              LDR      r1,|L4.356|
00010e  f8410025          STR      r0,[r1,r5,LSL #2]     ;478
000112  69a0              LDR      r0,[r4,#0x18]         ;479
000114  b930              CBNZ     r0,|L4.292|
000116  2000              MOVS     r0,#0                 ;480
000118  6961              LDR      r1,[r4,#0x14]         ;480
00011a  6188              STR      r0,[r1,#0x18]         ;480
00011c  4916              LDR      r1,|L4.376|
00011e  6960              LDR      r0,[r4,#0x14]         ;481
000120  6008              STR      r0,[r1,#0]            ;481  ; OSTCBList
000122  e005              B        |L4.304|
                  |L4.292|
000124  e9d40105          LDRD     r0,r1,[r4,#0x14]      ;483
000128  6148              STR      r0,[r1,#0x14]         ;483
00012a  e9d41005          LDRD     r1,r0,[r4,#0x14]      ;484
00012e  6188              STR      r0,[r1,#0x18]         ;484
                  |L4.304|
000130  4812              LDR      r0,|L4.380|
000132  6800              LDR      r0,[r0,#0]            ;486  ; OSTCBFreeList
000134  6160              STR      r0,[r4,#0x14]         ;486
000136  4811              LDR      r0,|L4.380|
000138  6004              STR      r4,[r0,#0]            ;487  ; OSTCBFreeList
00013a  203f              MOVS     r0,#0x3f              ;489
00013c  f8840048          STRB     r0,[r4,#0x48]         ;489
000140  2100              MOVS     r1,#0                 ;490
000142  2049              MOVS     r0,#0x49              ;490
000144  5501              STRB     r1,[r0,r4]            ;490
000146  4648              MOV      r0,r9                 ;492
000148  f7fffffe          BL       OS_CPU_SR_Restore
00014c  480c              LDR      r0,|L4.384|
00014e  7800              LDRB     r0,[r0,#0]            ;493  ; OSRunning
000150  2801              CMP      r0,#1                 ;493
000152  d101              BNE      |L4.344|
000154  f7fffffe          BL       OS_Sched
                  |L4.344|
000158  2000              MOVS     r0,#0                 ;496
00015a  e75b              B        |L4.20|
;;;498    #endif
                          ENDP

                  |L4.348|
                          DCD      OSIntNesting
                  |L4.352|
                          DCD      OSTCBCur
                  |L4.356|
                          DCD      OSTCBPrioTbl
                  |L4.360|
                          DCD      OSRdyTbl
                  |L4.364|
                          DCD      OSRdyGrp
                  |L4.368|
                          DCD      OSLockNesting
                  |L4.372|
                          DCD      OSTaskCtr
                  |L4.376|
                          DCD      OSTCBList
                  |L4.380|
                          DCD      OSTCBFreeList
                  |L4.384|
                          DCD      OSRunning

                          AREA ||i.OSTaskDelReq||, CODE, READONLY, ALIGN=2

                  OSTaskDelReq PROC
;;;546    #if OS_TASK_DEL_EN > 0
;;;547    INT8U  OSTaskDelReq (INT8U prio)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;548    {
000004  4604              MOV      r4,r0
;;;549        INT8U      stat;
;;;550        OS_TCB    *ptcb;
;;;551    #if OS_CRITICAL_METHOD == 3                      /* Allocate storage for CPU status register           */
;;;552        OS_CPU_SR  cpu_sr = 0;
000006  2700              MOVS     r7,#0
;;;553    #endif
;;;554    
;;;555    
;;;556    
;;;557        if (prio == OS_TASK_IDLE_PRIO) {                            /* Not allowed to delete idle task     */
000008  2c3f              CMP      r4,#0x3f
00000a  d102              BNE      |L5.18|
;;;558            return (OS_ERR_TASK_DEL_IDLE);
00000c  203e              MOVS     r0,#0x3e
                  |L5.14|
;;;559        }
;;;560    #if OS_ARG_CHK_EN > 0
;;;561        if (prio >= OS_LOWEST_PRIO) {                               /* Task priority valid ?               */
;;;562            if (prio != OS_PRIO_SELF) {
;;;563                return (OS_ERR_PRIO_INVALID);
;;;564            }
;;;565        }
;;;566    #endif
;;;567        if (prio == OS_PRIO_SELF) {                                 /* See if a task is requesting to ...  */
;;;568            OS_ENTER_CRITICAL();                                    /* ... this task to delete itself      */
;;;569            stat = OSTCBCur->OSTCBDelReq;                           /* Return request status to caller     */
;;;570            OS_EXIT_CRITICAL();
;;;571            return (stat);
;;;572        }
;;;573        OS_ENTER_CRITICAL();
;;;574        ptcb = OSTCBPrioTbl[prio];
;;;575        if (ptcb == (OS_TCB *)0) {                                  /* Task to delete must exist           */
;;;576            OS_EXIT_CRITICAL();
;;;577            return (OS_ERR_TASK_NOT_EXIST);                         /* Task must already be deleted        */
;;;578        }
;;;579        if (ptcb == OS_TCB_RESERVED) {                              /* Must NOT be assigned to a Mutex     */
;;;580            OS_EXIT_CRITICAL();
;;;581            return (OS_ERR_TASK_DEL);
;;;582        }
;;;583        ptcb->OSTCBDelReq = OS_ERR_TASK_DEL_REQ;                    /* Set flag indicating task to be DEL. */
;;;584        OS_EXIT_CRITICAL();
;;;585        return (OS_ERR_NONE);
;;;586    }
00000e  e8bd81f0          POP      {r4-r8,pc}
                  |L5.18|
000012  2c3f              CMP      r4,#0x3f              ;561
000014  db03              BLT      |L5.30|
000016  2cff              CMP      r4,#0xff              ;562
000018  d001              BEQ      |L5.30|
00001a  202a              MOVS     r0,#0x2a              ;563
00001c  e7f7              B        |L5.14|
                  |L5.30|
00001e  2cff              CMP      r4,#0xff              ;567
000020  d10b              BNE      |L5.58|
000022  f7fffffe          BL       OS_CPU_SR_Save
000026  4607              MOV      r7,r0                 ;568
000028  4811              LDR      r0,|L5.112|
00002a  6800              LDR      r0,[r0,#0]            ;569  ; OSTCBCur
00002c  f8906033          LDRB     r6,[r0,#0x33]         ;569
000030  4638              MOV      r0,r7                 ;570
000032  f7fffffe          BL       OS_CPU_SR_Restore
000036  4630              MOV      r0,r6                 ;571
000038  e7e9              B        |L5.14|
                  |L5.58|
00003a  f7fffffe          BL       OS_CPU_SR_Save
00003e  4607              MOV      r7,r0                 ;573
000040  480c              LDR      r0,|L5.116|
000042  f8505024          LDR      r5,[r0,r4,LSL #2]     ;574
000046  b925              CBNZ     r5,|L5.82|
000048  4638              MOV      r0,r7                 ;576
00004a  f7fffffe          BL       OS_CPU_SR_Restore
00004e  2043              MOVS     r0,#0x43              ;577
000050  e7dd              B        |L5.14|
                  |L5.82|
000052  2d01              CMP      r5,#1                 ;579
000054  d104              BNE      |L5.96|
000056  4638              MOV      r0,r7                 ;580
000058  f7fffffe          BL       OS_CPU_SR_Restore
00005c  203d              MOVS     r0,#0x3d              ;581
00005e  e7d6              B        |L5.14|
                  |L5.96|
000060  203f              MOVS     r0,#0x3f              ;583
000062  f8850033          STRB     r0,[r5,#0x33]         ;583
000066  4638              MOV      r0,r7                 ;584
000068  f7fffffe          BL       OS_CPU_SR_Restore
00006c  2000              MOVS     r0,#0                 ;585
00006e  e7ce              B        |L5.14|
;;;587    #endif
                          ENDP

                  |L5.112|
                          DCD      OSTCBCur
                  |L5.116|
                          DCD      OSTCBPrioTbl

                          AREA ||i.OSTaskNameGet||, CODE, READONLY, ALIGN=2

                  OSTaskNameGet PROC
;;;614    #if OS_TASK_NAME_SIZE > 1
;;;615    INT8U  OSTaskNameGet (INT8U prio, INT8U *pname, INT8U *perr)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;616    {
000004  4605              MOV      r5,r0
000006  460f              MOV      r7,r1
000008  4614              MOV      r4,r2
;;;617        OS_TCB    *ptcb;
;;;618        INT8U      len;
;;;619    #if OS_CRITICAL_METHOD == 3                              /* Allocate storage for CPU status register   */
;;;620        OS_CPU_SR  cpu_sr = 0;
00000a  f04f0800          MOV      r8,#0
;;;621    #endif
;;;622    
;;;623    
;;;624    
;;;625    #if OS_ARG_CHK_EN > 0
;;;626        if (perr == (INT8U *)0) {                            /* Validate 'perr'                            */
00000e  b914              CBNZ     r4,|L6.22|
;;;627            return (0);
000010  2000              MOVS     r0,#0
                  |L6.18|
;;;628        }
;;;629        if (prio > OS_LOWEST_PRIO) {                         /* Task priority valid ?                      */
;;;630            if (prio != OS_PRIO_SELF) {
;;;631                *perr = OS_ERR_PRIO_INVALID;                 /* No                                         */
;;;632                return (0);
;;;633            }
;;;634        }
;;;635        if (pname == (INT8U *)0) {                           /* Is 'pname' a NULL pointer?                 */
;;;636            *perr = OS_ERR_PNAME_NULL;                       /* Yes                                        */
;;;637            return (0);
;;;638        }
;;;639    #endif
;;;640        if (OSIntNesting > 0) {                              /* See if trying to call from an ISR          */
;;;641            *perr = OS_ERR_NAME_GET_ISR;
;;;642            return (0);
;;;643        }
;;;644        OS_ENTER_CRITICAL();
;;;645        if (prio == OS_PRIO_SELF) {                          /* See if caller desires it's own name        */
;;;646            prio = OSTCBCur->OSTCBPrio;
;;;647        }
;;;648        ptcb = OSTCBPrioTbl[prio];
;;;649        if (ptcb == (OS_TCB *)0) {                           /* Does task exist?                           */
;;;650            OS_EXIT_CRITICAL();                              /* No                                         */
;;;651            *perr = OS_ERR_TASK_NOT_EXIST;
;;;652            return (0);
;;;653        }
;;;654        if (ptcb == OS_TCB_RESERVED) {                       /* Task assigned to a Mutex?                  */
;;;655            OS_EXIT_CRITICAL();                              /* Yes                                        */
;;;656            *perr = OS_ERR_TASK_NOT_EXIST;
;;;657            return (0);
;;;658        }
;;;659        len   = OS_StrCopy(pname, ptcb->OSTCBTaskName);      /* Yes, copy name from TCB                    */
;;;660        OS_EXIT_CRITICAL();
;;;661        *perr = OS_ERR_NONE;
;;;662        return (len);
;;;663    }
000012  e8bd87f0          POP      {r4-r10,pc}
                  |L6.22|
000016  2d3f              CMP      r5,#0x3f              ;629
000018  dd05              BLE      |L6.38|
00001a  2dff              CMP      r5,#0xff              ;630
00001c  d003              BEQ      |L6.38|
00001e  202a              MOVS     r0,#0x2a              ;631
000020  7020              STRB     r0,[r4,#0]            ;631
000022  2000              MOVS     r0,#0                 ;632
000024  e7f5              B        |L6.18|
                  |L6.38|
000026  b91f              CBNZ     r7,|L6.48|
000028  200c              MOVS     r0,#0xc               ;636
00002a  7020              STRB     r0,[r4,#0]            ;636
00002c  2000              MOVS     r0,#0                 ;637
00002e  e7f0              B        |L6.18|
                  |L6.48|
000030  4818              LDR      r0,|L6.148|
000032  7800              LDRB     r0,[r0,#0]            ;640  ; OSIntNesting
000034  2800              CMP      r0,#0                 ;640
000036  dd03              BLE      |L6.64|
000038  2011              MOVS     r0,#0x11              ;641
00003a  7020              STRB     r0,[r4,#0]            ;641
00003c  2000              MOVS     r0,#0                 ;642
00003e  e7e8              B        |L6.18|
                  |L6.64|
000040  f7fffffe          BL       OS_CPU_SR_Save
000044  4680              MOV      r8,r0                 ;644
000046  2dff              CMP      r5,#0xff              ;645
000048  d103              BNE      |L6.82|
00004a  4813              LDR      r0,|L6.152|
00004c  6800              LDR      r0,[r0,#0]            ;646  ; OSTCBCur
00004e  f890502e          LDRB     r5,[r0,#0x2e]         ;646
                  |L6.82|
000052  4812              LDR      r0,|L6.156|
000054  f8506025          LDR      r6,[r0,r5,LSL #2]     ;648
000058  b936              CBNZ     r6,|L6.104|
00005a  4640              MOV      r0,r8                 ;650
00005c  f7fffffe          BL       OS_CPU_SR_Restore
000060  2043              MOVS     r0,#0x43              ;651
000062  7020              STRB     r0,[r4,#0]            ;651
000064  2000              MOVS     r0,#0                 ;652
000066  e7d4              B        |L6.18|
                  |L6.104|
000068  2e01              CMP      r6,#1                 ;654
00006a  d106              BNE      |L6.122|
00006c  4640              MOV      r0,r8                 ;655
00006e  f7fffffe          BL       OS_CPU_SR_Restore
000072  2043              MOVS     r0,#0x43              ;656
000074  7020              STRB     r0,[r4,#0]            ;656
000076  2000              MOVS     r0,#0                 ;657
000078  e7cb              B        |L6.18|
                  |L6.122|
00007a  f1060148          ADD      r1,r6,#0x48           ;659
00007e  4638              MOV      r0,r7                 ;659
000080  f7fffffe          BL       OS_StrCopy
000084  4681              MOV      r9,r0                 ;659
000086  4640              MOV      r0,r8                 ;660
000088  f7fffffe          BL       OS_CPU_SR_Restore
00008c  2000              MOVS     r0,#0                 ;661
00008e  7020              STRB     r0,[r4,#0]            ;661
000090  4648              MOV      r0,r9                 ;662
000092  e7be              B        |L6.18|
;;;664    #endif
                          ENDP

                  |L6.148|
                          DCD      OSIntNesting
                  |L6.152|
                          DCD      OSTCBCur
                  |L6.156|
                          DCD      OSTCBPrioTbl

                          AREA ||i.OSTaskNameSet||, CODE, READONLY, ALIGN=2

                  OSTaskNameSet PROC
;;;693    #if OS_TASK_NAME_SIZE > 1
;;;694    void  OSTaskNameSet (INT8U prio, INT8U *pname, INT8U *perr)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;695    {
000004  4605              MOV      r5,r0
000006  460f              MOV      r7,r1
000008  4614              MOV      r4,r2
;;;696        INT8U      len;
;;;697        OS_TCB    *ptcb;
;;;698    #if OS_CRITICAL_METHOD == 3                          /* Allocate storage for CPU status register       */
;;;699        OS_CPU_SR  cpu_sr = 0;
00000a  f04f0900          MOV      r9,#0
;;;700    #endif
;;;701    
;;;702    
;;;703    
;;;704    #if OS_ARG_CHK_EN > 0
;;;705        if (perr == (INT8U *)0) {                        /* Validate 'perr'                                */
00000e  b90c              CBNZ     r4,|L7.20|
                  |L7.16|
;;;706            return;
;;;707        }
;;;708        if (prio > OS_LOWEST_PRIO) {                     /* Task priority valid ?                          */
;;;709            if (prio != OS_PRIO_SELF) {
;;;710                *perr = OS_ERR_PRIO_INVALID;             /* No                                             */
;;;711                return;
;;;712            }
;;;713        }
;;;714        if (pname == (INT8U *)0) {                       /* Is 'pname' a NULL pointer?                     */
;;;715            *perr = OS_ERR_PNAME_NULL;                   /* Yes                                            */
;;;716            return;
;;;717        }
;;;718    #endif
;;;719        if (OSIntNesting > 0) {                          /* See if trying to call from an ISR              */
;;;720            *perr = OS_ERR_NAME_SET_ISR;
;;;721            return;
;;;722        }
;;;723        OS_ENTER_CRITICAL();
;;;724        if (prio == OS_PRIO_SELF) {                      /* See if caller desires to set it's own name     */
;;;725            prio = OSTCBCur->OSTCBPrio;
;;;726        }
;;;727        ptcb = OSTCBPrioTbl[prio];
;;;728        if (ptcb == (OS_TCB *)0) {                       /* Does task exist?                               */
;;;729            OS_EXIT_CRITICAL();                          /* No                                             */
;;;730            *perr = OS_ERR_TASK_NOT_EXIST;
;;;731            return;
;;;732        }
;;;733        if (ptcb == OS_TCB_RESERVED) {                   /* Task assigned to a Mutex?                      */
;;;734            OS_EXIT_CRITICAL();                          /* Yes                                            */
;;;735            *perr = OS_ERR_TASK_NOT_EXIST;
;;;736            return;
;;;737        }
;;;738        len = OS_StrLen(pname);                          /* Yes, Can we fit the string in the TCB?         */
;;;739        if (len > (OS_TASK_NAME_SIZE - 1)) {             /*      No                                        */
;;;740            OS_EXIT_CRITICAL();
;;;741            *perr = OS_ERR_TASK_NAME_TOO_LONG;
;;;742            return;
;;;743        }
;;;744        (void)OS_StrCopy(ptcb->OSTCBTaskName, pname);    /*      Yes, copy to TCB                          */
;;;745        OS_EXIT_CRITICAL();
;;;746        *perr = OS_ERR_NONE;
;;;747    }
000010  e8bd87f0          POP      {r4-r10,pc}
                  |L7.20|
000014  2d3f              CMP      r5,#0x3f              ;708
000016  dd04              BLE      |L7.34|
000018  2dff              CMP      r5,#0xff              ;709
00001a  d002              BEQ      |L7.34|
00001c  202a              MOVS     r0,#0x2a              ;710
00001e  7020              STRB     r0,[r4,#0]            ;710
000020  e7f6              B        |L7.16|
                  |L7.34|
000022  b917              CBNZ     r7,|L7.42|
000024  200c              MOVS     r0,#0xc               ;715
000026  7020              STRB     r0,[r4,#0]            ;715
000028  e7f2              B        |L7.16|
                  |L7.42|
00002a  481d              LDR      r0,|L7.160|
00002c  7800              LDRB     r0,[r0,#0]            ;719  ; OSIntNesting
00002e  2800              CMP      r0,#0                 ;719
000030  dd02              BLE      |L7.56|
000032  2012              MOVS     r0,#0x12              ;720
000034  7020              STRB     r0,[r4,#0]            ;720
000036  e7eb              B        |L7.16|
                  |L7.56|
000038  f7fffffe          BL       OS_CPU_SR_Save
00003c  4681              MOV      r9,r0                 ;723
00003e  2dff              CMP      r5,#0xff              ;724
000040  d103              BNE      |L7.74|
000042  4818              LDR      r0,|L7.164|
000044  6800              LDR      r0,[r0,#0]            ;725  ; OSTCBCur
000046  f890502e          LDRB     r5,[r0,#0x2e]         ;725
                  |L7.74|
00004a  4817              LDR      r0,|L7.168|
00004c  f8506025          LDR      r6,[r0,r5,LSL #2]     ;727
000050  b92e              CBNZ     r6,|L7.94|
000052  4648              MOV      r0,r9                 ;729
000054  f7fffffe          BL       OS_CPU_SR_Restore
000058  2043              MOVS     r0,#0x43              ;730
00005a  7020              STRB     r0,[r4,#0]            ;730
00005c  e7d8              B        |L7.16|
                  |L7.94|
00005e  2e01              CMP      r6,#1                 ;733
000060  d105              BNE      |L7.110|
000062  4648              MOV      r0,r9                 ;734
000064  f7fffffe          BL       OS_CPU_SR_Restore
000068  2043              MOVS     r0,#0x43              ;735
00006a  7020              STRB     r0,[r4,#0]            ;735
00006c  e7d0              B        |L7.16|
                  |L7.110|
00006e  4638              MOV      r0,r7                 ;738
000070  f7fffffe          BL       OS_StrLen
000074  4680              MOV      r8,r0                 ;738
000076  f1b80f0f          CMP      r8,#0xf               ;739
00007a  dd05              BLE      |L7.136|
00007c  4648              MOV      r0,r9                 ;740
00007e  f7fffffe          BL       OS_CPU_SR_Restore
000082  2041              MOVS     r0,#0x41              ;741
000084  7020              STRB     r0,[r4,#0]            ;741
000086  e7c3              B        |L7.16|
                  |L7.136|
000088  4639              MOV      r1,r7                 ;744
00008a  f1060048          ADD      r0,r6,#0x48           ;744
00008e  f7fffffe          BL       OS_StrCopy
000092  4648              MOV      r0,r9                 ;745
000094  f7fffffe          BL       OS_CPU_SR_Restore
000098  2000              MOVS     r0,#0                 ;746
00009a  7020              STRB     r0,[r4,#0]            ;746
00009c  bf00              NOP      
00009e  e7b7              B        |L7.16|
;;;748    #endif
                          ENDP

                  |L7.160|
                          DCD      OSIntNesting
                  |L7.164|
                          DCD      OSTCBCur
                  |L7.168|
                          DCD      OSTCBPrioTbl

                          AREA ||i.OSTaskQuery||, CODE, READONLY, ALIGN=2

                  OSTaskQuery PROC
;;;993    #if OS_TASK_QUERY_EN > 0
;;;994    INT8U  OSTaskQuery (INT8U prio, OS_TCB *p_task_data)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;995    {
000004  4604              MOV      r4,r0
000006  460e              MOV      r6,r1
;;;996        OS_TCB    *ptcb;
;;;997    #if OS_CRITICAL_METHOD == 3                      /* Allocate storage for CPU status register           */
;;;998        OS_CPU_SR  cpu_sr = 0;
000008  2700              MOVS     r7,#0
;;;999    #endif
;;;1000   
;;;1001   
;;;1002   
;;;1003   #if OS_ARG_CHK_EN > 0
;;;1004       if (prio > OS_LOWEST_PRIO) {                 /* Task priority valid ?                              */
00000a  2c3f              CMP      r4,#0x3f
00000c  dd04              BLE      |L8.24|
;;;1005           if (prio != OS_PRIO_SELF) {
00000e  2cff              CMP      r4,#0xff
000010  d002              BEQ      |L8.24|
;;;1006               return (OS_ERR_PRIO_INVALID);
000012  202a              MOVS     r0,#0x2a
                  |L8.20|
;;;1007           }
;;;1008       }
;;;1009       if (p_task_data == (OS_TCB *)0) {            /* Validate 'p_task_data'                             */
;;;1010           return (OS_ERR_PDATA_NULL);
;;;1011       }
;;;1012   #endif
;;;1013       OS_ENTER_CRITICAL();
;;;1014       if (prio == OS_PRIO_SELF) {                  /* See if suspend SELF                                */
;;;1015           prio = OSTCBCur->OSTCBPrio;
;;;1016       }
;;;1017       ptcb = OSTCBPrioTbl[prio];
;;;1018       if (ptcb == (OS_TCB *)0) {                   /* Task to query must exist                           */
;;;1019           OS_EXIT_CRITICAL();
;;;1020           return (OS_ERR_PRIO);
;;;1021       }
;;;1022       if (ptcb == OS_TCB_RESERVED) {               /* Task to query must not be assigned to a Mutex      */
;;;1023           OS_EXIT_CRITICAL();
;;;1024           return (OS_ERR_TASK_NOT_EXIST);
;;;1025       }
;;;1026       /* Copy TCB into user storage area                    */
;;;1027       OS_MemCopy((INT8U *)p_task_data, (INT8U *)ptcb, sizeof(OS_TCB));
;;;1028       OS_EXIT_CRITICAL();
;;;1029       return (OS_ERR_NONE);
;;;1030   }
000014  e8bd81f0          POP      {r4-r8,pc}
                  |L8.24|
000018  b90e              CBNZ     r6,|L8.30|
00001a  2009              MOVS     r0,#9                 ;1010
00001c  e7fa              B        |L8.20|
                  |L8.30|
00001e  f7fffffe          BL       OS_CPU_SR_Save
000022  4607              MOV      r7,r0                 ;1013
000024  2cff              CMP      r4,#0xff              ;1014
000026  d103              BNE      |L8.48|
000028  480e              LDR      r0,|L8.100|
00002a  6800              LDR      r0,[r0,#0]            ;1015  ; OSTCBCur
00002c  f890402e          LDRB     r4,[r0,#0x2e]         ;1015
                  |L8.48|
000030  480d              LDR      r0,|L8.104|
000032  f8505024          LDR      r5,[r0,r4,LSL #2]     ;1017
000036  b925              CBNZ     r5,|L8.66|
000038  4638              MOV      r0,r7                 ;1019
00003a  f7fffffe          BL       OS_CPU_SR_Restore
00003e  2029              MOVS     r0,#0x29              ;1020
000040  e7e8              B        |L8.20|
                  |L8.66|
000042  2d01              CMP      r5,#1                 ;1022
000044  d104              BNE      |L8.80|
000046  4638              MOV      r0,r7                 ;1023
000048  f7fffffe          BL       OS_CPU_SR_Restore
00004c  2043              MOVS     r0,#0x43              ;1024
00004e  e7e1              B        |L8.20|
                  |L8.80|
000050  2258              MOVS     r2,#0x58              ;1027
000052  4629              MOV      r1,r5                 ;1027
000054  4630              MOV      r0,r6                 ;1027
000056  f7fffffe          BL       OS_MemCopy
00005a  4638              MOV      r0,r7                 ;1028
00005c  f7fffffe          BL       OS_CPU_SR_Restore
000060  2000              MOVS     r0,#0                 ;1029
000062  e7d7              B        |L8.20|
;;;1031   #endif
                          ENDP

                  |L8.100|
                          DCD      OSTCBCur
                  |L8.104|
                          DCD      OSTCBPrioTbl

                          AREA ||i.OSTaskResume||, CODE, READONLY, ALIGN=2

                  OSTaskResume PROC
;;;769    #if OS_TASK_SUSPEND_EN > 0
;;;770    INT8U  OSTaskResume (INT8U prio)
000000  b570              PUSH     {r4-r6,lr}
;;;771    {
000002  4605              MOV      r5,r0
;;;772        OS_TCB    *ptcb;
;;;773    #if OS_CRITICAL_METHOD == 3                                   /* Storage for CPU status register       */
;;;774        OS_CPU_SR  cpu_sr = 0;
000004  2600              MOVS     r6,#0
;;;775    #endif
;;;776    
;;;777    
;;;778    
;;;779    #if OS_ARG_CHK_EN > 0
;;;780        if (prio >= OS_LOWEST_PRIO) {                             /* Make sure task priority is valid      */
000006  2d3f              CMP      r5,#0x3f
000008  db01              BLT      |L9.14|
;;;781            return (OS_ERR_PRIO_INVALID);
00000a  202a              MOVS     r0,#0x2a
                  |L9.12|
;;;782        }
;;;783    #endif
;;;784        OS_ENTER_CRITICAL();
;;;785        ptcb = OSTCBPrioTbl[prio];
;;;786        if (ptcb == (OS_TCB *)0) {                                /* Task to suspend must exist            */
;;;787            OS_EXIT_CRITICAL();
;;;788            return (OS_ERR_TASK_RESUME_PRIO);
;;;789        }
;;;790        if (ptcb == OS_TCB_RESERVED) {                            /* See if assigned to Mutex              */
;;;791            OS_EXIT_CRITICAL();
;;;792            return (OS_ERR_TASK_NOT_EXIST);
;;;793        }
;;;794        if ((ptcb->OSTCBStat & OS_STAT_SUSPEND) != OS_STAT_RDY) { /* Task must be suspended                */
;;;795            ptcb->OSTCBStat &= ~(INT8U)OS_STAT_SUSPEND;           /* Remove suspension                     */
;;;796            if (ptcb->OSTCBStat == OS_STAT_RDY) {                 /* See if task is now ready              */
;;;797                if (ptcb->OSTCBDly == 0) {
;;;798                    OSRdyGrp               |= ptcb->OSTCBBitY;    /* Yes, Make task ready to run           */
;;;799                    OSRdyTbl[ptcb->OSTCBY] |= ptcb->OSTCBBitX;
;;;800                    OS_EXIT_CRITICAL();
;;;801                    if (OSRunning == OS_TRUE) {
;;;802                        OS_Sched();                               /* Find new highest priority task        */
;;;803                    }
;;;804                } else {
;;;805                    OS_EXIT_CRITICAL();
;;;806                }
;;;807            } else {                                              /* Must be pending on event              */
;;;808                OS_EXIT_CRITICAL();
;;;809            }
;;;810            return (OS_ERR_NONE);
;;;811        }
;;;812        OS_EXIT_CRITICAL();
;;;813        return (OS_ERR_TASK_NOT_SUSPENDED);
;;;814    }
00000c  bd70              POP      {r4-r6,pc}
                  |L9.14|
00000e  f7fffffe          BL       OS_CPU_SR_Save
000012  4606              MOV      r6,r0                 ;784
000014  4824              LDR      r0,|L9.168|
000016  f8504025          LDR      r4,[r0,r5,LSL #2]     ;785
00001a  b924              CBNZ     r4,|L9.38|
00001c  4630              MOV      r0,r6                 ;787
00001e  f7fffffe          BL       OS_CPU_SR_Restore
000022  2046              MOVS     r0,#0x46              ;788
000024  e7f2              B        |L9.12|
                  |L9.38|
000026  2c01              CMP      r4,#1                 ;790
000028  d104              BNE      |L9.52|
00002a  4630              MOV      r0,r6                 ;791
00002c  f7fffffe          BL       OS_CPU_SR_Restore
000030  2043              MOVS     r0,#0x43              ;792
000032  e7eb              B        |L9.12|
                  |L9.52|
000034  f894002c          LDRB     r0,[r4,#0x2c]         ;794
000038  f0100f08          TST      r0,#8                 ;794
00003c  d02f              BEQ      |L9.158|
00003e  f8140f2c          LDRB     r0,[r4,#0x2c]!        ;795
000042  f0200008          BIC      r0,r0,#8              ;795
000046  7020              STRB     r0,[r4,#0]            ;795
000048  f814092c          LDRB     r0,[r4],#-0x2c        ;796
00004c  bb10              CBNZ     r0,|L9.148|
00004e  8d60              LDRH     r0,[r4,#0x2a]         ;797
000050  b9e0              CBNZ     r0,|L9.140|
000052  f1040430          ADD      r4,r4,#0x30           ;798
000056  78a0              LDRB     r0,[r4,#2]            ;798
000058  4914              LDR      r1,|L9.172|
00005a  7809              LDRB     r1,[r1,#0]            ;798  ; OSRdyGrp
00005c  ea400001          ORR      r0,r0,r1              ;798
000060  4912              LDR      r1,|L9.172|
000062  7008              STRB     r0,[r1,#0]            ;798
000064  7820              LDRB     r0,[r4,#0]            ;799
000066  4912              LDR      r1,|L9.176|
000068  5c08              LDRB     r0,[r1,r0]            ;799
00006a  7861              LDRB     r1,[r4,#1]            ;799
00006c  ea400001          ORR      r0,r0,r1              ;799
000070  f8141930          LDRB     r1,[r4],#-0x30        ;799
000074  4a0e              LDR      r2,|L9.176|
000076  5450              STRB     r0,[r2,r1]            ;799
000078  4630              MOV      r0,r6                 ;800
00007a  f7fffffe          BL       OS_CPU_SR_Restore
00007e  480d              LDR      r0,|L9.180|
000080  7800              LDRB     r0,[r0,#0]            ;801  ; OSRunning
000082  2801              CMP      r0,#1                 ;801
000084  d109              BNE      |L9.154|
000086  f7fffffe          BL       OS_Sched
00008a  e006              B        |L9.154|
                  |L9.140|
00008c  4630              MOV      r0,r6                 ;805
00008e  f7fffffe          BL       OS_CPU_SR_Restore
000092  e002              B        |L9.154|
                  |L9.148|
000094  4630              MOV      r0,r6                 ;808
000096  f7fffffe          BL       OS_CPU_SR_Restore
                  |L9.154|
00009a  2000              MOVS     r0,#0                 ;810
00009c  e7b6              B        |L9.12|
                  |L9.158|
00009e  4630              MOV      r0,r6                 ;812
0000a0  f7fffffe          BL       OS_CPU_SR_Restore
0000a4  2044              MOVS     r0,#0x44              ;813
0000a6  e7b1              B        |L9.12|
;;;815    #endif
                          ENDP

                  |L9.168|
                          DCD      OSTCBPrioTbl
                  |L9.172|
                          DCD      OSRdyGrp
                  |L9.176|
                          DCD      OSRdyTbl
                  |L9.180|
                          DCD      OSRunning

                          AREA ||i.OSTaskStkChk||, CODE, READONLY, ALIGN=2

                  OSTaskStkChk PROC
;;;836    #if OS_TASK_CREATE_EXT_EN > 0
;;;837    INT8U  OSTaskStkChk (INT8U prio, OS_STK_DATA *p_stk_data)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;838    {
000004  4606              MOV      r6,r0
000006  460c              MOV      r4,r1
;;;839        OS_TCB    *ptcb;
;;;840        OS_STK    *pchk;
;;;841        INT32U     free;
;;;842        INT32U     size;
;;;843    #if OS_CRITICAL_METHOD == 3                            /* Allocate storage for CPU status register     */
;;;844        OS_CPU_SR  cpu_sr = 0;
000008  f04f0a00          MOV      r10,#0
;;;845    #endif
;;;846    
;;;847    
;;;848    
;;;849    #if OS_ARG_CHK_EN > 0
;;;850        if (prio > OS_LOWEST_PRIO) {                       /* Make sure task priority is valid             */
00000c  2e3f              CMP      r6,#0x3f
00000e  dd04              BLE      |L10.26|
;;;851            if (prio != OS_PRIO_SELF) {
000010  2eff              CMP      r6,#0xff
000012  d002              BEQ      |L10.26|
;;;852                return (OS_ERR_PRIO_INVALID);
000014  202a              MOVS     r0,#0x2a
                  |L10.22|
;;;853            }
;;;854        }
;;;855        if (p_stk_data == (OS_STK_DATA *)0) {              /* Validate 'p_stk_data'                        */
;;;856            return (OS_ERR_PDATA_NULL);
;;;857        }
;;;858    #endif
;;;859        p_stk_data->OSFree = 0;                            /* Assume failure, set to 0 size                */
;;;860        p_stk_data->OSUsed = 0;
;;;861        OS_ENTER_CRITICAL();
;;;862        if (prio == OS_PRIO_SELF) {                        /* See if check for SELF                        */
;;;863            prio = OSTCBCur->OSTCBPrio;
;;;864        }
;;;865        ptcb = OSTCBPrioTbl[prio];
;;;866        if (ptcb == (OS_TCB *)0) {                         /* Make sure task exist                         */
;;;867            OS_EXIT_CRITICAL();
;;;868            return (OS_ERR_TASK_NOT_EXIST);
;;;869        }
;;;870        if (ptcb == OS_TCB_RESERVED) {
;;;871            OS_EXIT_CRITICAL();
;;;872            return (OS_ERR_TASK_NOT_EXIST);
;;;873        }
;;;874        if ((ptcb->OSTCBOpt & OS_TASK_OPT_STK_CHK) == 0) { /* Make sure stack checking option is set       */
;;;875            OS_EXIT_CRITICAL();
;;;876            return (OS_ERR_TASK_OPT);
;;;877        }
;;;878        free = 0;
;;;879        size = ptcb->OSTCBStkSize;
;;;880        pchk = ptcb->OSTCBStkBottom;
;;;881        OS_EXIT_CRITICAL();
;;;882    #if OS_STK_GROWTH == 1
;;;883        while (*pchk++ == (OS_STK)0) {                    /* Compute the number of zero entries on the stk */
;;;884            free++;
;;;885        }
;;;886    #else
;;;887        while (*pchk-- == (OS_STK)0) {
;;;888            free++;
;;;889        }
;;;890    #endif
;;;891        p_stk_data->OSFree = free * sizeof(OS_STK);           /* Compute number of free bytes on the stack */
;;;892        p_stk_data->OSUsed = (size - free) * sizeof(OS_STK);  /* Compute number of bytes used on the stack */
;;;893        return (OS_ERR_NONE);
;;;894    }
000016  e8bd87f0          POP      {r4-r10,pc}
                  |L10.26|
00001a  b90c              CBNZ     r4,|L10.32|
00001c  2009              MOVS     r0,#9                 ;856
00001e  e7fa              B        |L10.22|
                  |L10.32|
000020  2000              MOVS     r0,#0                 ;859
000022  6020              STR      r0,[r4,#0]            ;859
000024  6060              STR      r0,[r4,#4]            ;860
000026  f7fffffe          BL       OS_CPU_SR_Save
00002a  4682              MOV      r10,r0                ;861
00002c  2eff              CMP      r6,#0xff              ;862
00002e  d103              BNE      |L10.56|
000030  4819              LDR      r0,|L10.152|
000032  6800              LDR      r0,[r0,#0]            ;863  ; OSTCBCur
000034  f890602e          LDRB     r6,[r0,#0x2e]         ;863
                  |L10.56|
000038  4818              LDR      r0,|L10.156|
00003a  f8505026          LDR      r5,[r0,r6,LSL #2]     ;865
00003e  b925              CBNZ     r5,|L10.74|
000040  4650              MOV      r0,r10                ;867
000042  f7fffffe          BL       OS_CPU_SR_Restore
000046  2043              MOVS     r0,#0x43              ;868
000048  e7e5              B        |L10.22|
                  |L10.74|
00004a  2d01              CMP      r5,#1                 ;870
00004c  d104              BNE      |L10.88|
00004e  4650              MOV      r0,r10                ;871
000050  f7fffffe          BL       OS_CPU_SR_Restore
000054  2043              MOVS     r0,#0x43              ;872
000056  e7de              B        |L10.22|
                  |L10.88|
000058  7c28              LDRB     r0,[r5,#0x10]         ;874
00005a  f0100f01          TST      r0,#1                 ;874
00005e  d104              BNE      |L10.106|
000060  4650              MOV      r0,r10                ;875
000062  f7fffffe          BL       OS_CPU_SR_Restore
000066  2045              MOVS     r0,#0x45              ;876
000068  e7d5              B        |L10.22|
                  |L10.106|
00006a  2700              MOVS     r7,#0                 ;878
00006c  f8d5900c          LDR      r9,[r5,#0xc]          ;879
000070  f8d58008          LDR      r8,[r5,#8]            ;880
000074  4650              MOV      r0,r10                ;881
000076  f7fffffe          BL       OS_CPU_SR_Restore
00007a  e000              B        |L10.126|
                  |L10.124|
00007c  1c7f              ADDS     r7,r7,#1              ;884
                  |L10.126|
00007e  f8581b04          LDR      r1,[r8],#4            ;883
000082  2900              CMP      r1,#0                 ;883
000084  d0fa              BEQ      |L10.124|
000086  00b8              LSLS     r0,r7,#2              ;891
000088  6020              STR      r0,[r4,#0]            ;891
00008a  eba90007          SUB      r0,r9,r7              ;892
00008e  0080              LSLS     r0,r0,#2              ;892
000090  6060              STR      r0,[r4,#4]            ;892
000092  2000              MOVS     r0,#0                 ;893
000094  e7bf              B        |L10.22|
;;;895    #endif
                          ENDP

000096  0000              DCW      0x0000
                  |L10.152|
                          DCD      OSTCBCur
                  |L10.156|
                          DCD      OSTCBPrioTbl

                          AREA ||i.OSTaskSuspend||, CODE, READONLY, ALIGN=2

                  OSTaskSuspend PROC
;;;920    #if OS_TASK_SUSPEND_EN > 0
;;;921    INT8U  OSTaskSuspend(INT8U prio)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;922    {
000004  4605              MOV      r5,r0
;;;923        BOOLEAN    self;
;;;924        OS_TCB    *ptcb;
;;;925        INT8U      y;
;;;926    #if OS_CRITICAL_METHOD == 3                      /* Allocate storage for CPU status register           */
;;;927        OS_CPU_SR  cpu_sr = 0;
000006  f04f0800          MOV      r8,#0
;;;928    #endif
;;;929    
;;;930    
;;;931    
;;;932    #if OS_ARG_CHK_EN > 0
;;;933        if (prio == OS_TASK_IDLE_PRIO) {                            /* Not allowed to suspend idle task    */
00000a  2d3f              CMP      r5,#0x3f
00000c  d102              BNE      |L11.20|
;;;934            return (OS_ERR_TASK_SUSPEND_IDLE);
00000e  2047              MOVS     r0,#0x47
                  |L11.16|
;;;935        }
;;;936        if (prio >= OS_LOWEST_PRIO) {                               /* Task priority valid ?               */
;;;937            if (prio != OS_PRIO_SELF) {
;;;938                return (OS_ERR_PRIO_INVALID);
;;;939            }
;;;940        }
;;;941    #endif
;;;942        OS_ENTER_CRITICAL();
;;;943        if (prio == OS_PRIO_SELF) {                                 /* See if suspend SELF                 */
;;;944            prio = OSTCBCur->OSTCBPrio;
;;;945            self = OS_TRUE;
;;;946        } else if (prio == OSTCBCur->OSTCBPrio) {                   /* See if suspending self              */
;;;947            self = OS_TRUE;
;;;948        } else {
;;;949            self = OS_FALSE;                                        /* No suspending another task          */
;;;950        }
;;;951        ptcb = OSTCBPrioTbl[prio];
;;;952        if (ptcb == (OS_TCB *)0) {                                  /* Task to suspend must exist          */
;;;953            OS_EXIT_CRITICAL();
;;;954            return (OS_ERR_TASK_SUSPEND_PRIO);
;;;955        }
;;;956        if (ptcb == OS_TCB_RESERVED) {                              /* See if assigned to Mutex            */
;;;957            OS_EXIT_CRITICAL();
;;;958            return (OS_ERR_TASK_NOT_EXIST);
;;;959        }
;;;960        y            = ptcb->OSTCBY;
;;;961        OSRdyTbl[y] &= ~ptcb->OSTCBBitX;                            /* Make task not ready                 */
;;;962        if (OSRdyTbl[y] == 0) {
;;;963            OSRdyGrp &= ~ptcb->OSTCBBitY;
;;;964        }
;;;965        ptcb->OSTCBStat |= OS_STAT_SUSPEND;                         /* Status of task is 'SUSPENDED'       */
;;;966        OS_EXIT_CRITICAL();
;;;967        if (self == OS_TRUE) {                                      /* Context switch only if SELF         */
;;;968            OS_Sched();                                             /* Find new highest priority task      */
;;;969        }
;;;970        return (OS_ERR_NONE);
;;;971    }
000010  e8bd81f0          POP      {r4-r8,pc}
                  |L11.20|
000014  2d3f              CMP      r5,#0x3f              ;936
000016  db03              BLT      |L11.32|
000018  2dff              CMP      r5,#0xff              ;937
00001a  d001              BEQ      |L11.32|
00001c  202a              MOVS     r0,#0x2a              ;938
00001e  e7f7              B        |L11.16|
                  |L11.32|
000020  f7fffffe          BL       OS_CPU_SR_Save
000024  4680              MOV      r8,r0                 ;942
000026  2dff              CMP      r5,#0xff              ;943
000028  d105              BNE      |L11.54|
00002a  4820              LDR      r0,|L11.172|
00002c  6800              LDR      r0,[r0,#0]            ;944  ; OSTCBCur
00002e  f890502e          LDRB     r5,[r0,#0x2e]         ;944
000032  2601              MOVS     r6,#1                 ;945
000034  e008              B        |L11.72|
                  |L11.54|
000036  481d              LDR      r0,|L11.172|
000038  6800              LDR      r0,[r0,#0]            ;946  ; OSTCBCur
00003a  f890002e          LDRB     r0,[r0,#0x2e]         ;946
00003e  42a8              CMP      r0,r5                 ;946
000040  d101              BNE      |L11.70|
000042  2601              MOVS     r6,#1                 ;947
000044  e000              B        |L11.72|
                  |L11.70|
000046  2600              MOVS     r6,#0                 ;949
                  |L11.72|
000048  4819              LDR      r0,|L11.176|
00004a  f8504025          LDR      r4,[r0,r5,LSL #2]     ;951
00004e  b924              CBNZ     r4,|L11.90|
000050  4640              MOV      r0,r8                 ;953
000052  f7fffffe          BL       OS_CPU_SR_Restore
000056  2048              MOVS     r0,#0x48              ;954
000058  e7da              B        |L11.16|
                  |L11.90|
00005a  2c01              CMP      r4,#1                 ;956
00005c  d104              BNE      |L11.104|
00005e  4640              MOV      r0,r8                 ;957
000060  f7fffffe          BL       OS_CPU_SR_Restore
000064  2043              MOVS     r0,#0x43              ;958
000066  e7d3              B        |L11.16|
                  |L11.104|
000068  f8947030          LDRB     r7,[r4,#0x30]         ;960
00006c  4811              LDR      r0,|L11.180|
00006e  5dc0              LDRB     r0,[r0,r7]            ;961
000070  f8941031          LDRB     r1,[r4,#0x31]         ;961
000074  4388              BICS     r0,r0,r1              ;961
000076  490f              LDR      r1,|L11.180|
000078  55c8              STRB     r0,[r1,r7]            ;961
00007a  4608              MOV      r0,r1                 ;962
00007c  5dc0              LDRB     r0,[r0,r7]            ;962
00007e  b930              CBNZ     r0,|L11.142|
000080  f8941032          LDRB     r1,[r4,#0x32]         ;963
000084  480c              LDR      r0,|L11.184|
000086  7800              LDRB     r0,[r0,#0]            ;963  ; OSRdyGrp
000088  4388              BICS     r0,r0,r1              ;963
00008a  490b              LDR      r1,|L11.184|
00008c  7008              STRB     r0,[r1,#0]            ;963
                  |L11.142|
00008e  f894002c          LDRB     r0,[r4,#0x2c]         ;965
000092  f0400008          ORR      r0,r0,#8              ;965
000096  f884002c          STRB     r0,[r4,#0x2c]         ;965
00009a  4640              MOV      r0,r8                 ;966
00009c  f7fffffe          BL       OS_CPU_SR_Restore
0000a0  2e01              CMP      r6,#1                 ;967
0000a2  d101              BNE      |L11.168|
0000a4  f7fffffe          BL       OS_Sched
                  |L11.168|
0000a8  2000              MOVS     r0,#0                 ;970
0000aa  e7b1              B        |L11.16|
;;;972    #endif
                          ENDP

                  |L11.172|
                          DCD      OSTCBCur
                  |L11.176|
                          DCD      OSTCBPrioTbl
                  |L11.180|
                          DCD      OSRdyTbl
                  |L11.184|
                          DCD      OSRdyGrp

                          AREA ||i.OS_TaskStkClr||, CODE, READONLY, ALIGN=1

                  OS_TaskStkClr PROC
;;;1055   #if OS_TASK_CREATE_EXT_EN > 0
;;;1056   void  OS_TaskStkClr (OS_STK *pbos, INT32U size, INT16U opt)
000000  f0120f01          TST      r2,#1
;;;1057   {
;;;1058       if ((opt & OS_TASK_OPT_STK_CHK) != 0x0000) {       /* See if stack checking has been enabled       */
000004  d008              BEQ      |L12.24|
;;;1059           if ((opt & OS_TASK_OPT_STK_CLR) != 0x0000) {   /* See if stack needs to be cleared             */
000006  f0120f02          TST      r2,#2
00000a  d005              BEQ      |L12.24|
;;;1060   #if OS_STK_GROWTH == 1
;;;1061               while (size > 0) {                         /* Stack grows from HIGH to LOW memory          */
00000c  e002              B        |L12.20|
                  |L12.14|
;;;1062                   size--;
00000e  1e49              SUBS     r1,r1,#1
;;;1063                   *pbos++ = (OS_STK)0;                   /* Clear from bottom of stack and up!           */
000010  2300              MOVS     r3,#0
000012  c008              STM      r0!,{r3}
                  |L12.20|
000014  2900              CMP      r1,#0                 ;1061
000016  d1fa              BNE      |L12.14|
                  |L12.24|
;;;1064               }
;;;1065   #else
;;;1066               while (size > 0) {                         /* Stack grows from LOW to HIGH memory          */
;;;1067                   size--;
;;;1068                   *pbos-- = (OS_STK)0;                   /* Clear from bottom of stack and down          */
;;;1069               }
;;;1070   #endif
;;;1071           }
;;;1072       }
;;;1073   }
000018  4770              BX       lr
;;;1074   
                          ENDP

