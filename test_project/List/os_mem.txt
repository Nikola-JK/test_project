; generated by ARM C/C++ Compiler, 5.03 [Build 76]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o.\obj\os_mem.o --asm_dir=.\List\ --list_dir=.\List\ --depend=.\obj\os_mem.d --cpu=Cortex-M3 --apcs=interwork -O0 -I.\Source\APP -I.\Source\BSP -I.\Source\uCOS-II\Source -I.\Source\uCOS-II\uC-CPU -I.\Source\uCOS-II\uC-LIB -I.\Source\uCOS-II\Ports -I.\Source\uCGUI\Config -I.\Source\uCGUI\emWinDemo -I.\Source\uCGUI\inc -I.\Source\uCGUI\LCDDriver -I.\Source\uCGUI\uCGUIDemo -I.\Source\Libraries\STM32F10x_StdPeriph_Driver\inc -I.\Source\Libraries\CMSIS\Core\CM3 -I.\Source\APP\HMI -I"D:\Program Files (x86)\keil\ARM\RV31\INC" -I"D:\Program Files (x86)\keil\ARM\PACK\ARM\CMSIS\3.20.3\CMSIS\Include" -I"D:\Program Files (x86)\keil\ARM\PACK\Keil\STM32F1xx_DFP\1.0.2\Device\Include" -DSTM32F10X_HD --omf_browse=.\obj\os_mem.crf Source\uCOS-II\Source\os_mem.c]
                          THUMB

                          AREA ||i.OSMemCreate||, CODE, READONLY, ALIGN=2

                  OSMemCreate PROC
;;;58     
;;;59     OS_MEM  *OSMemCreate (void *addr, INT32U nblks, INT32U blksize, INT8U *perr)
000000  e92d4ff8          PUSH     {r3-r11,lr}
;;;60     {
000004  4606              MOV      r6,r0
000006  460f              MOV      r7,r1
000008  4690              MOV      r8,r2
00000a  461c              MOV      r4,r3
;;;61         OS_MEM    *pmem;
;;;62         INT8U     *pblk;
;;;63         void     **plink;
;;;64         INT32U     i;
;;;65     #if OS_CRITICAL_METHOD == 3                           /* Allocate storage for CPU status register      */
;;;66         OS_CPU_SR  cpu_sr = 0;
00000c  2000              MOVS     r0,#0
00000e  9000              STR      r0,[sp,#0]
;;;67     #endif
;;;68     
;;;69     
;;;70     
;;;71     #if OS_ARG_CHK_EN > 0
;;;72         if (perr == (INT8U *)0) {                         /* Validate 'perr'                               */
000010  b90c              CBNZ     r4,|L1.22|
                  |L1.18|
;;;73             return ((OS_MEM *)0);
;;;74         }
;;;75         if (addr == (void *)0) {                          /* Must pass a valid address for the memory part.*/
;;;76             *perr = OS_ERR_MEM_INVALID_ADDR;
;;;77             return ((OS_MEM *)0);
;;;78         }
;;;79         if (((INT32U)addr & (sizeof(void *) - 1)) != 0) { /* Must be pointer size aligned                  */
;;;80             *perr = OS_ERR_MEM_INVALID_ADDR;
;;;81             return ((OS_MEM *)0);
;;;82         }
;;;83         if (nblks < 2) {                                  /* Must have at least 2 blocks per partition     */
;;;84             *perr = OS_ERR_MEM_INVALID_BLKS;
;;;85             return ((OS_MEM *)0);
;;;86         }
;;;87         if (blksize < sizeof(void *)) {                   /* Must contain space for at least a pointer     */
;;;88             *perr = OS_ERR_MEM_INVALID_SIZE;
;;;89             return ((OS_MEM *)0);
;;;90         }
;;;91     #endif
;;;92         OS_ENTER_CRITICAL();
;;;93         pmem = OSMemFreeList;                             /* Get next free memory partition                */
;;;94         if (OSMemFreeList != (OS_MEM *)0) {               /* See if pool of free partitions was empty      */
;;;95             OSMemFreeList = (OS_MEM *)OSMemFreeList->OSMemFreeList;
;;;96         }
;;;97         OS_EXIT_CRITICAL();
;;;98         if (pmem == (OS_MEM *)0) {                        /* See if we have a memory partition             */
;;;99             *perr = OS_ERR_MEM_INVALID_PART;
;;;100            return ((OS_MEM *)0);
;;;101        }
;;;102        plink = (void **)addr;                            /* Create linked list of free memory blocks      */
;;;103        pblk  = (INT8U *)((INT32U)addr + blksize);
;;;104        for (i = 0; i < (nblks - 1); i++) {
;;;105            *plink = (void *)pblk;                         /* Save pointer to NEXT block in CURRENT block   */
;;;106            plink = (void **)pblk;                        /* Position to  NEXT      block                  */
;;;107            pblk  = (INT8U *)((INT32U)pblk + blksize);    /* Point to the FOLLOWING block                  */
;;;108        }
;;;109        *plink              = (void *)0;                  /* Last memory block points to NULL              */
;;;110        pmem->OSMemAddr     = addr;                       /* Store start address of memory partition       */
;;;111        pmem->OSMemFreeList = addr;                       /* Initialize pointer to pool of free blocks     */
;;;112        pmem->OSMemNFree    = nblks;                      /* Store number of free blocks in MCB            */
;;;113        pmem->OSMemNBlks    = nblks;
;;;114        pmem->OSMemBlkSize  = blksize;                    /* Store block size of each memory blocks        */
;;;115        *perr               = OS_ERR_NONE;
;;;116        return (pmem);
;;;117    }
000012  e8bd8ff8          POP      {r3-r11,pc}
                  |L1.22|
000016  b91e              CBNZ     r6,|L1.32|
000018  2062              MOVS     r0,#0x62              ;76
00001a  7020              STRB     r0,[r4,#0]            ;76
00001c  2000              MOVS     r0,#0                 ;77
00001e  e7f8              B        |L1.18|
                  |L1.32|
000020  f0160f03          TST      r6,#3                 ;79
000024  d003              BEQ      |L1.46|
000026  2062              MOVS     r0,#0x62              ;80
000028  7020              STRB     r0,[r4,#0]            ;80
00002a  2000              MOVS     r0,#0                 ;81
00002c  e7f1              B        |L1.18|
                  |L1.46|
00002e  2f02              CMP      r7,#2                 ;83
000030  d203              BCS      |L1.58|
000032  205b              MOVS     r0,#0x5b              ;84
000034  7020              STRB     r0,[r4,#0]            ;84
000036  2000              MOVS     r0,#0                 ;85
000038  e7eb              B        |L1.18|
                  |L1.58|
00003a  f1b80f04          CMP      r8,#4                 ;87
00003e  d203              BCS      |L1.72|
000040  205c              MOVS     r0,#0x5c              ;88
000042  7020              STRB     r0,[r4,#0]            ;88
000044  2000              MOVS     r0,#0                 ;89
000046  e7e4              B        |L1.18|
                  |L1.72|
000048  f7fffffe          BL       OS_CPU_SR_Save
00004c  9000              STR      r0,[sp,#0]            ;92
00004e  4816              LDR      r0,|L1.168|
000050  6805              LDR      r5,[r0,#0]            ;93  ; OSMemFreeList
000052  6800              LDR      r0,[r0,#0]            ;94  ; OSMemFreeList
000054  b120              CBZ      r0,|L1.96|
000056  4814              LDR      r0,|L1.168|
000058  6800              LDR      r0,[r0,#0]            ;95  ; OSMemFreeList
00005a  6840              LDR      r0,[r0,#4]            ;95
00005c  4912              LDR      r1,|L1.168|
00005e  6008              STR      r0,[r1,#0]            ;95  ; OSMemFreeList
                  |L1.96|
000060  9800              LDR      r0,[sp,#0]            ;97
000062  f7fffffe          BL       OS_CPU_SR_Restore
000066  b91d              CBNZ     r5,|L1.112|
000068  205a              MOVS     r0,#0x5a              ;99
00006a  7020              STRB     r0,[r4,#0]            ;99
00006c  2000              MOVS     r0,#0                 ;100
00006e  e7d0              B        |L1.18|
                  |L1.112|
000070  46b1              MOV      r9,r6                 ;102
000072  eb060a08          ADD      r10,r6,r8             ;103
000076  f04f0b00          MOV      r11,#0                ;104
00007a  e005              B        |L1.136|
                  |L1.124|
00007c  f8c9a000          STR      r10,[r9,#0]           ;105
000080  46d1              MOV      r9,r10                ;106
000082  44c2              ADD      r10,r10,r8            ;107
000084  f10b0b01          ADD      r11,r11,#1            ;104
                  |L1.136|
000088  1e78              SUBS     r0,r7,#1              ;104
00008a  4558              CMP      r0,r11                ;104
00008c  d8f6              BHI      |L1.124|
00008e  2000              MOVS     r0,#0                 ;109
000090  f8c90000          STR      r0,[r9,#0]            ;109
000094  602e              STR      r6,[r5,#0]            ;110
000096  606e              STR      r6,[r5,#4]            ;111
000098  612f              STR      r7,[r5,#0x10]         ;112
00009a  60ef              STR      r7,[r5,#0xc]          ;113
00009c  f8c58008          STR      r8,[r5,#8]            ;114
0000a0  7020              STRB     r0,[r4,#0]            ;115
0000a2  4628              MOV      r0,r5                 ;116
0000a4  e7b5              B        |L1.18|
;;;118    /*$PAGE*/
                          ENDP

0000a6  0000              DCW      0x0000
                  |L1.168|
                          DCD      OSMemFreeList

                          AREA ||i.OSMemGet||, CODE, READONLY, ALIGN=1

                  OSMemGet PROC
;;;138    
;;;139    void  *OSMemGet (OS_MEM *pmem, INT8U *perr)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;140    {
000004  4604              MOV      r4,r0
000006  460d              MOV      r5,r1
;;;141        void      *pblk;
;;;142    #if OS_CRITICAL_METHOD == 3                           /* Allocate storage for CPU status register      */
;;;143        OS_CPU_SR  cpu_sr = 0;
000008  2700              MOVS     r7,#0
;;;144    #endif
;;;145    
;;;146    
;;;147    
;;;148    #if OS_ARG_CHK_EN > 0
;;;149        if (perr == (INT8U *)0) {                         /* Validate 'perr'                               */
00000a  b915              CBNZ     r5,|L2.18|
;;;150            return ((void *)0);
00000c  2000              MOVS     r0,#0
                  |L2.14|
;;;151        }
;;;152        if (pmem == (OS_MEM *)0) {                        /* Must point to a valid memory partition        */
;;;153            *perr = OS_ERR_MEM_INVALID_PMEM;
;;;154            return ((void *)0);
;;;155        }
;;;156    #endif
;;;157        OS_ENTER_CRITICAL();
;;;158        if (pmem->OSMemNFree > 0) {                       /* See if there are any free memory blocks       */
;;;159            pblk                = pmem->OSMemFreeList;    /* Yes, point to next free memory block          */
;;;160            pmem->OSMemFreeList = *(void **)pblk;         /*      Adjust pointer to new free list          */
;;;161            pmem->OSMemNFree--;                           /*      One less memory block in this partition  */
;;;162            OS_EXIT_CRITICAL();
;;;163            *perr = OS_ERR_NONE;                          /*      No error                                 */
;;;164            return (pblk);                                /*      Return memory block to caller            */
;;;165        }
;;;166        OS_EXIT_CRITICAL();
;;;167        *perr = OS_ERR_MEM_NO_FREE_BLKS;                  /* No,  Notify caller of empty memory partition  */
;;;168        return ((void *)0);                               /*      Return NULL pointer to caller            */
;;;169    }
00000e  e8bd81f0          POP      {r4-r8,pc}
                  |L2.18|
000012  b91c              CBNZ     r4,|L2.28|
000014  2060              MOVS     r0,#0x60              ;153
000016  7028              STRB     r0,[r5,#0]            ;153
000018  2000              MOVS     r0,#0                 ;154
00001a  e7f8              B        |L2.14|
                  |L2.28|
00001c  f7fffffe          BL       OS_CPU_SR_Save
000020  4607              MOV      r7,r0                 ;157
000022  6920              LDR      r0,[r4,#0x10]         ;158
000024  b160              CBZ      r0,|L2.64|
000026  6866              LDR      r6,[r4,#4]            ;159
000028  6830              LDR      r0,[r6,#0]            ;160
00002a  6060              STR      r0,[r4,#4]            ;160
00002c  6920              LDR      r0,[r4,#0x10]         ;161
00002e  1e40              SUBS     r0,r0,#1              ;161
000030  6120              STR      r0,[r4,#0x10]         ;161
000032  4638              MOV      r0,r7                 ;162
000034  f7fffffe          BL       OS_CPU_SR_Restore
000038  2000              MOVS     r0,#0                 ;163
00003a  7028              STRB     r0,[r5,#0]            ;163
00003c  4630              MOV      r0,r6                 ;164
00003e  e7e6              B        |L2.14|
                  |L2.64|
000040  4638              MOV      r0,r7                 ;166
000042  f7fffffe          BL       OS_CPU_SR_Restore
000046  205d              MOVS     r0,#0x5d              ;167
000048  7028              STRB     r0,[r5,#0]            ;167
00004a  2000              MOVS     r0,#0                 ;168
00004c  e7df              B        |L2.14|
;;;170    /*$PAGE*/
                          ENDP


                          AREA ||i.OSMemNameGet||, CODE, READONLY, ALIGN=2

                  OSMemNameGet PROC
;;;192    #if OS_MEM_NAME_SIZE > 1
;;;193    INT8U  OSMemNameGet (OS_MEM *pmem, INT8U *pname, INT8U *perr)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;194    {
000004  4605              MOV      r5,r0
000006  460e              MOV      r6,r1
000008  4614              MOV      r4,r2
;;;195        INT8U      len;
;;;196    #if OS_CRITICAL_METHOD == 3                      /* Allocate storage for CPU status register           */
;;;197        OS_CPU_SR  cpu_sr = 0;
00000a  2700              MOVS     r7,#0
;;;198    #endif
;;;199    
;;;200    
;;;201    
;;;202    #if OS_ARG_CHK_EN > 0
;;;203        if (perr == (INT8U *)0) {                    /* Validate 'perr'                                    */
00000c  b914              CBNZ     r4,|L3.20|
;;;204            return (0);
00000e  2000              MOVS     r0,#0
                  |L3.16|
;;;205        }
;;;206        if (pmem == (OS_MEM *)0) {                   /* Is 'pmem' a NULL pointer?                          */
;;;207            *perr = OS_ERR_MEM_INVALID_PMEM;
;;;208            return (0);
;;;209        }
;;;210        if (pname == (INT8U *)0) {                   /* Is 'pname' a NULL pointer?                         */
;;;211            *perr = OS_ERR_PNAME_NULL;
;;;212            return (0);
;;;213        }
;;;214    #endif
;;;215        if (OSIntNesting > 0) {                      /* See if trying to call from an ISR                  */
;;;216            *perr = OS_ERR_NAME_GET_ISR;
;;;217            return (0);
;;;218        }
;;;219        OS_ENTER_CRITICAL();
;;;220        len   = OS_StrCopy(pname, pmem->OSMemName);  /* Copy name from OS_MEM                              */
;;;221        OS_EXIT_CRITICAL();
;;;222        *perr = OS_ERR_NONE;
;;;223        return (len);
;;;224    }
000010  e8bd81f0          POP      {r4-r8,pc}
                  |L3.20|
000014  b91d              CBNZ     r5,|L3.30|
000016  2060              MOVS     r0,#0x60              ;207
000018  7020              STRB     r0,[r4,#0]            ;207
00001a  2000              MOVS     r0,#0                 ;208
00001c  e7f8              B        |L3.16|
                  |L3.30|
00001e  b91e              CBNZ     r6,|L3.40|
000020  200c              MOVS     r0,#0xc               ;211
000022  7020              STRB     r0,[r4,#0]            ;211
000024  2000              MOVS     r0,#0                 ;212
000026  e7f3              B        |L3.16|
                  |L3.40|
000028  480b              LDR      r0,|L3.88|
00002a  7800              LDRB     r0,[r0,#0]            ;215  ; OSIntNesting
00002c  2800              CMP      r0,#0                 ;215
00002e  dd03              BLE      |L3.56|
000030  2011              MOVS     r0,#0x11              ;216
000032  7020              STRB     r0,[r4,#0]            ;216
000034  2000              MOVS     r0,#0                 ;217
000036  e7eb              B        |L3.16|
                  |L3.56|
000038  f7fffffe          BL       OS_CPU_SR_Save
00003c  4607              MOV      r7,r0                 ;219
00003e  f1050114          ADD      r1,r5,#0x14           ;220
000042  4630              MOV      r0,r6                 ;220
000044  f7fffffe          BL       OS_StrCopy
000048  4680              MOV      r8,r0                 ;220
00004a  4638              MOV      r0,r7                 ;221
00004c  f7fffffe          BL       OS_CPU_SR_Restore
000050  2000              MOVS     r0,#0                 ;222
000052  7020              STRB     r0,[r4,#0]            ;222
000054  4640              MOV      r0,r8                 ;223
000056  e7db              B        |L3.16|
;;;225    #endif
                          ENDP

                  |L3.88|
                          DCD      OSIntNesting

                          AREA ||i.OSMemNameSet||, CODE, READONLY, ALIGN=2

                  OSMemNameSet PROC
;;;250    #if OS_MEM_NAME_SIZE > 1
;;;251    void  OSMemNameSet (OS_MEM *pmem, INT8U *pname, INT8U *perr)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;252    {
000004  4605              MOV      r5,r0
000006  460e              MOV      r6,r1
000008  4614              MOV      r4,r2
;;;253        INT8U      len;
;;;254    #if OS_CRITICAL_METHOD == 3                      /* Allocate storage for CPU status register           */
;;;255        OS_CPU_SR  cpu_sr = 0;
00000a  f04f0800          MOV      r8,#0
;;;256    #endif
;;;257    
;;;258    
;;;259    
;;;260    #if OS_ARG_CHK_EN > 0
;;;261        if (perr == (INT8U *)0) {                    /* Validate 'perr'                                    */
00000e  b90c              CBNZ     r4,|L4.20|
                  |L4.16|
;;;262            return;
;;;263        }
;;;264        if (pmem == (OS_MEM *)0) {                   /* Is 'pmem' a NULL pointer?                          */
;;;265            *perr = OS_ERR_MEM_INVALID_PMEM;
;;;266            return;
;;;267        }
;;;268        if (pname == (INT8U *)0) {                   /* Is 'pname' a NULL pointer?                         */
;;;269            *perr = OS_ERR_PNAME_NULL;
;;;270            return;
;;;271        }
;;;272    #endif
;;;273        if (OSIntNesting > 0) {                      /* See if trying to call from an ISR                  */
;;;274            *perr = OS_ERR_NAME_SET_ISR;
;;;275            return;
;;;276        }
;;;277        OS_ENTER_CRITICAL();
;;;278        len = OS_StrLen(pname);                      /* Can we fit the string in the storage area?         */
;;;279        if (len > (OS_MEM_NAME_SIZE - 1)) {          /* No                                                 */
;;;280            OS_EXIT_CRITICAL();
;;;281            *perr = OS_ERR_MEM_NAME_TOO_LONG;
;;;282            return;
;;;283        }
;;;284        (void)OS_StrCopy(pmem->OSMemName, pname);    /* Yes, copy name to the memory partition header      */
;;;285        OS_EXIT_CRITICAL();
;;;286        *perr = OS_ERR_NONE;
;;;287    }
000010  e8bd81f0          POP      {r4-r8,pc}
                  |L4.20|
000014  b915              CBNZ     r5,|L4.28|
000016  2060              MOVS     r0,#0x60              ;265
000018  7020              STRB     r0,[r4,#0]            ;265
00001a  e7f9              B        |L4.16|
                  |L4.28|
00001c  b916              CBNZ     r6,|L4.36|
00001e  200c              MOVS     r0,#0xc               ;269
000020  7020              STRB     r0,[r4,#0]            ;269
000022  e7f5              B        |L4.16|
                  |L4.36|
000024  4810              LDR      r0,|L4.104|
000026  7800              LDRB     r0,[r0,#0]            ;273  ; OSIntNesting
000028  2800              CMP      r0,#0                 ;273
00002a  dd02              BLE      |L4.50|
00002c  2012              MOVS     r0,#0x12              ;274
00002e  7020              STRB     r0,[r4,#0]            ;274
000030  e7ee              B        |L4.16|
                  |L4.50|
000032  f7fffffe          BL       OS_CPU_SR_Save
000036  4680              MOV      r8,r0                 ;277
000038  4630              MOV      r0,r6                 ;278
00003a  f7fffffe          BL       OS_StrLen
00003e  4607              MOV      r7,r0                 ;278
000040  2f0f              CMP      r7,#0xf               ;279
000042  dd05              BLE      |L4.80|
000044  4640              MOV      r0,r8                 ;280
000046  f7fffffe          BL       OS_CPU_SR_Restore
00004a  2063              MOVS     r0,#0x63              ;281
00004c  7020              STRB     r0,[r4,#0]            ;281
00004e  e7df              B        |L4.16|
                  |L4.80|
000050  4631              MOV      r1,r6                 ;284
000052  f1050014          ADD      r0,r5,#0x14           ;284
000056  f7fffffe          BL       OS_StrCopy
00005a  4640              MOV      r0,r8                 ;285
00005c  f7fffffe          BL       OS_CPU_SR_Restore
000060  2000              MOVS     r0,#0                 ;286
000062  7020              STRB     r0,[r4,#0]            ;286
000064  bf00              NOP      
000066  e7d3              B        |L4.16|
;;;288    #endif
                          ENDP

                  |L4.104|
                          DCD      OSIntNesting

                          AREA ||i.OSMemPut||, CODE, READONLY, ALIGN=1

                  OSMemPut PROC
;;;308    
;;;309    INT8U  OSMemPut (OS_MEM *pmem, void *pblk)
000000  b570              PUSH     {r4-r6,lr}
;;;310    {
000002  4604              MOV      r4,r0
000004  460d              MOV      r5,r1
;;;311    #if OS_CRITICAL_METHOD == 3                      /* Allocate storage for CPU status register           */
;;;312        OS_CPU_SR  cpu_sr = 0;
000006  2600              MOVS     r6,#0
;;;313    #endif
;;;314    
;;;315    
;;;316    
;;;317    #if OS_ARG_CHK_EN > 0
;;;318        if (pmem == (OS_MEM *)0) {                   /* Must point to a valid memory partition             */
000008  b90c              CBNZ     r4,|L5.14|
;;;319            return (OS_ERR_MEM_INVALID_PMEM);
00000a  2060              MOVS     r0,#0x60
                  |L5.12|
;;;320        }
;;;321        if (pblk == (void *)0) {                     /* Must release a valid block                         */
;;;322            return (OS_ERR_MEM_INVALID_PBLK);
;;;323        }
;;;324    #endif
;;;325        OS_ENTER_CRITICAL();
;;;326        if (pmem->OSMemNFree >= pmem->OSMemNBlks) {  /* Make sure all blocks not already returned          */
;;;327            OS_EXIT_CRITICAL();
;;;328            return (OS_ERR_MEM_FULL);
;;;329        }
;;;330        *(void **)pblk      = pmem->OSMemFreeList;   /* Insert released block into free block list         */
;;;331        pmem->OSMemFreeList = pblk;
;;;332        pmem->OSMemNFree++;                          /* One more memory block in this partition            */
;;;333        OS_EXIT_CRITICAL();
;;;334        return (OS_ERR_NONE);                        /* Notify caller that memory block was released       */
;;;335    }
00000c  bd70              POP      {r4-r6,pc}
                  |L5.14|
00000e  b90d              CBNZ     r5,|L5.20|
000010  205f              MOVS     r0,#0x5f              ;322
000012  e7fb              B        |L5.12|
                  |L5.20|
000014  f7fffffe          BL       OS_CPU_SR_Save
000018  4606              MOV      r6,r0                 ;325
00001a  e9d41003          LDRD     r1,r0,[r4,#0xc]       ;326
00001e  4288              CMP      r0,r1                 ;326
000020  d304              BCC      |L5.44|
000022  4630              MOV      r0,r6                 ;327
000024  f7fffffe          BL       OS_CPU_SR_Restore
000028  205e              MOVS     r0,#0x5e              ;328
00002a  e7ef              B        |L5.12|
                  |L5.44|
00002c  6860              LDR      r0,[r4,#4]            ;330
00002e  6028              STR      r0,[r5,#0]            ;330
000030  6065              STR      r5,[r4,#4]            ;331
000032  6920              LDR      r0,[r4,#0x10]         ;332
000034  1c40              ADDS     r0,r0,#1              ;332
000036  6120              STR      r0,[r4,#0x10]         ;332
000038  4630              MOV      r0,r6                 ;333
00003a  f7fffffe          BL       OS_CPU_SR_Restore
00003e  2000              MOVS     r0,#0                 ;334
000040  e7e4              B        |L5.12|
;;;336    /*$PAGE*/
                          ENDP


                          AREA ||i.OSMemQuery||, CODE, READONLY, ALIGN=1

                  OSMemQuery PROC
;;;355    #if OS_MEM_QUERY_EN > 0
;;;356    INT8U  OSMemQuery (OS_MEM *pmem, OS_MEM_DATA *p_mem_data)
000000  b570              PUSH     {r4-r6,lr}
;;;357    {
000002  4605              MOV      r5,r0
000004  460c              MOV      r4,r1
;;;358    #if OS_CRITICAL_METHOD == 3                      /* Allocate storage for CPU status register           */
;;;359        OS_CPU_SR  cpu_sr = 0;
000006  2600              MOVS     r6,#0
;;;360    #endif
;;;361    
;;;362    
;;;363    
;;;364    #if OS_ARG_CHK_EN > 0
;;;365        if (pmem == (OS_MEM *)0) {                   /* Must point to a valid memory partition             */
000008  b90d              CBNZ     r5,|L6.14|
;;;366            return (OS_ERR_MEM_INVALID_PMEM);
00000a  2060              MOVS     r0,#0x60
                  |L6.12|
;;;367        }
;;;368        if (p_mem_data == (OS_MEM_DATA *)0) {        /* Must release a valid storage area for the data     */
;;;369            return (OS_ERR_MEM_INVALID_PDATA);
;;;370        }
;;;371    #endif
;;;372        OS_ENTER_CRITICAL();
;;;373        p_mem_data->OSAddr     = pmem->OSMemAddr;
;;;374        p_mem_data->OSFreeList = pmem->OSMemFreeList;
;;;375        p_mem_data->OSBlkSize  = pmem->OSMemBlkSize;
;;;376        p_mem_data->OSNBlks    = pmem->OSMemNBlks;
;;;377        p_mem_data->OSNFree    = pmem->OSMemNFree;
;;;378        OS_EXIT_CRITICAL();
;;;379        p_mem_data->OSNUsed    = p_mem_data->OSNBlks - p_mem_data->OSNFree;
;;;380        return (OS_ERR_NONE);
;;;381    }
00000c  bd70              POP      {r4-r6,pc}
                  |L6.14|
00000e  b90c              CBNZ     r4,|L6.20|
000010  2061              MOVS     r0,#0x61              ;369
000012  e7fb              B        |L6.12|
                  |L6.20|
000014  f7fffffe          BL       OS_CPU_SR_Save
000018  4606              MOV      r6,r0                 ;372
00001a  6828              LDR      r0,[r5,#0]            ;373
00001c  6020              STR      r0,[r4,#0]            ;373
00001e  6868              LDR      r0,[r5,#4]            ;374
000020  6060              STR      r0,[r4,#4]            ;374
000022  68a8              LDR      r0,[r5,#8]            ;375
000024  60a0              STR      r0,[r4,#8]            ;375
000026  68e8              LDR      r0,[r5,#0xc]          ;376
000028  60e0              STR      r0,[r4,#0xc]          ;376
00002a  6928              LDR      r0,[r5,#0x10]         ;377
00002c  6120              STR      r0,[r4,#0x10]         ;377
00002e  4630              MOV      r0,r6                 ;378
000030  f7fffffe          BL       OS_CPU_SR_Restore
000034  e9d40103          LDRD     r0,r1,[r4,#0xc]       ;379
000038  1a40              SUBS     r0,r0,r1              ;379
00003a  6160              STR      r0,[r4,#0x14]         ;379
00003c  2000              MOVS     r0,#0                 ;380
00003e  e7e5              B        |L6.12|
;;;382    #endif                                           /* OS_MEM_QUERY_EN                                    */
                          ENDP


                          AREA ||i.OS_MemInit||, CODE, READONLY, ALIGN=2

                  OS_MemInit PROC
;;;398    
;;;399    void  OS_MemInit (void)
000000  b570              PUSH     {r4-r6,lr}
;;;400    {
;;;401    #if OS_MAX_MEM_PART == 1
;;;402        OS_MemClr((INT8U *)&OSMemTbl[0], sizeof(OSMemTbl));   /* Clear the memory partition table          */
;;;403        OSMemFreeList               = (OS_MEM *)&OSMemTbl[0]; /* Point to beginning of free list           */
;;;404    #if OS_MEM_NAME_SIZE > 1
;;;405        OSMemFreeList->OSMemName[0] = '?';                    /* Unknown name                              */
;;;406        OSMemFreeList->OSMemName[1] = OS_ASCII_NUL;
;;;407    #endif
;;;408    #endif
;;;409    
;;;410    #if OS_MAX_MEM_PART >= 2
;;;411        OS_MEM  *pmem;
;;;412        INT16U   i;
;;;413    
;;;414    
;;;415        OS_MemClr((INT8U *)&OSMemTbl[0], sizeof(OSMemTbl));   /* Clear the memory partition table          */
000002  21b4              MOVS     r1,#0xb4
000004  480f              LDR      r0,|L7.68|
000006  f7fffffe          BL       OS_MemClr
;;;416        pmem = &OSMemTbl[0];                                  /* Point to memory control block (MCB)       */
00000a  4c0e              LDR      r4,|L7.68|
;;;417        for (i = 0; i < (OS_MAX_MEM_PART - 1); i++) {         /* Init. list of free memory partitions      */
00000c  2500              MOVS     r5,#0
00000e  e00d              B        |L7.44|
                  |L7.16|
;;;418            pmem->OSMemFreeList = (void *)&OSMemTbl[i+1];     /* Chain list of free partitions             */
000010  1c68              ADDS     r0,r5,#1
000012  eb0000c0          ADD      r0,r0,r0,LSL #3
000016  490b              LDR      r1,|L7.68|
000018  eb010080          ADD      r0,r1,r0,LSL #2
00001c  6060              STR      r0,[r4,#4]
;;;419    #if OS_MEM_NAME_SIZE > 1
;;;420            pmem->OSMemName[0]  = '?';                        /* Unknown name                              */
00001e  203f              MOVS     r0,#0x3f
000020  7520              STRB     r0,[r4,#0x14]
;;;421            pmem->OSMemName[1]  = OS_ASCII_NUL;
000022  2100              MOVS     r1,#0
000024  7561              STRB     r1,[r4,#0x15]
;;;422    #endif
;;;423            pmem++;
000026  3424              ADDS     r4,r4,#0x24
000028  1c68              ADDS     r0,r5,#1              ;417
00002a  b285              UXTH     r5,r0                 ;417
                  |L7.44|
00002c  2d04              CMP      r5,#4                 ;417
00002e  dbef              BLT      |L7.16|
;;;424        }
;;;425        pmem->OSMemFreeList = (void *)0;                      /* Initialize last node                      */
000030  2000              MOVS     r0,#0
000032  6060              STR      r0,[r4,#4]
;;;426    #if OS_MEM_NAME_SIZE > 1
;;;427        pmem->OSMemName[0]  = '?';                            /* Unknown name                              */
000034  203f              MOVS     r0,#0x3f
000036  7520              STRB     r0,[r4,#0x14]
;;;428        pmem->OSMemName[1]  = OS_ASCII_NUL;
000038  2100              MOVS     r1,#0
00003a  7561              STRB     r1,[r4,#0x15]
;;;429    #endif
;;;430    
;;;431        OSMemFreeList       = &OSMemTbl[0];                   /* Point to beginning of free list           */
00003c  4801              LDR      r0,|L7.68|
00003e  4902              LDR      r1,|L7.72|
000040  6008              STR      r0,[r1,#0]  ; OSMemFreeList
;;;432    #endif
;;;433    }
000042  bd70              POP      {r4-r6,pc}
;;;434    #endif                                                    /* OS_MEM_EN                                 */
                          ENDP

                  |L7.68|
                          DCD      OSMemTbl
                  |L7.72|
                          DCD      OSMemFreeList
